{"version":3,"file":"ortbConverter.js","mappings":"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","sources":["webpack:///../../libraries/ortbConverter/converter.ts","webpack:///../../libraries/ortbConverter/lib/composer.js","webpack:///../../libraries/ortbConverter/lib/mergeProcessors.js","webpack:///../../libraries/ortbConverter/processors/audio.js","webpack:///../../libraries/ortbConverter/processors/banner.js","webpack:///../../libraries/ortbConverter/processors/default.js","webpack:///../../libraries/ortbConverter/processors/mediaType.js","webpack:///../../libraries/ortbConverter/processors/native.js","webpack:///../../libraries/ortbConverter/processors/video.js"],"sourcesContent":["import {compose} from './lib/composer.js';\nimport {logError, memoize} from '../../src/utils.js';\nimport {DEFAULT_PROCESSORS} from './processors/default.js';\nimport {BID_RESPONSE, DEFAULT, getProcessors, IMP, REQUEST, RESPONSE} from '../../src/pbjsORTB.js';\nimport {mergeProcessors} from './lib/mergeProcessors.js';\nimport type {MediaType} from \"../../src/mediaTypes.ts\";\nimport type {NativeRequest} from '../../src/types/ortb/native.d.ts';\nimport type {ORTBImp, ORTBRequest} from \"../../src/types/ortb/request.d.ts\";\nimport type {Currency, BidderCode} from \"../../src/types/common.d.ts\";\nimport type {BidderRequest, BidRequest} from \"../../src/adapterManager.ts\";\nimport type {BidResponse} from \"../../src/bidfactory.ts\";\nimport type {AdapterResponse} from \"../../src/adapters/bidderFactory.ts\";\nimport type {ORTBResponse} from \"../../src/types/ortb/response\";\n\ntype Context = {\n  [key: string]: unknown;\n  /**\n   * A currency string (e.g. `'EUR'`). If specified, overrides the currency to use for computing price floors and `request.cur`.\n   * If omitted, both default to `getConfig('currency.adServerCurrency')`.\n   */\n  currency?: Currency;\n  /**\n   * A bid mediaType (`'banner'`, `'video'`, or `'native'`). If specified:\n   *  - disables `imp` generation for other media types (i.e., if `context.mediaType === 'banner'`, only `imp.banner` will be populated; `imp.video` and `imp.native` will not, even if the bid request specifies them);\n   *  - is passed as the `mediaType` option to `bidRequest.getFloor` when computing price floors;\n   *  - sets `bidResponse.mediaType`.\n   */\n  mediaType?: MediaType;\n  /**\n   * A plain object that serves as the base value for `imp.native.request` (and is relevant only for native bid requests).\n   * If not specified, the only property that is guaranteed to be populated is `assets`, since Prebid does not\n   * require anything else to define a native adUnit. You can use `context.nativeRequest` to provide other properties;\n   * for example, you may want to signal support for native impression trackers by setting it to `{eventtrackers: [{event: 1, methods: [1, 2]}]}` (see also the [ORTB Native spec](https://www.iab.com/wp-content/uploads/2018/03/OpenRTB-Native-Ads-Specification-Final-1.2.pdf)).\n   */\n  nativeRequest?: Partial<NativeRequest>;\n  /**\n   * The value to set as `bidResponse.netRevenue`. This is a required property of bid responses that does not have a clear ORTB counterpart.\n   */\n  netRevenue?: boolean;\n  /**\n   * the default value to use for `bidResponse.ttl` (if the ORTB response does not provide one in `seatbid[].bid[].exp`).\n   */\n  ttl?: number;\n}\n\ntype RequestContext = Context & {\n  /**\n   * Map from imp id to the context object used to generate that imp.\n   */\n  impContext: { [impId: string]: Context };\n}\n\ntype Params<B extends BidderCode> = {\n  [IMP]: (\n    bidRequest: BidRequest<B>,\n    context: Context & {\n      bidderRequest: BidderRequest<B>\n    }\n  ) => ORTBImp;\n  [REQUEST]: (\n    imps: ORTBImp[],\n    bidderRequest: BidderRequest<B>,\n    context: RequestContext & {\n      bidRequests: BidRequest<B>[]\n    }\n  ) => ORTBRequest;\n  [BID_RESPONSE]: (\n    bid: ORTBResponse['seatbid'][number]['bid'][number],\n    context: Context & {\n      seatbid: ORTBResponse['seatbid'][number];\n      imp: ORTBImp;\n      bidRequest: BidRequest<B>;\n      ortbRequest: ORTBRequest;\n      ortbResponse: ORTBResponse;\n    }\n  ) => BidResponse;\n  [RESPONSE]: (\n    bidResponses: BidResponse[],\n    ortbResponse: ORTBResponse,\n    context: RequestContext & {\n      ortbRequest: ORTBRequest;\n      bidderRequest: BidderRequest<B>;\n      bidRequests: BidRequest<B>[];\n    }\n  ) => AdapterResponse\n}\n\ntype Processors<B extends BidderCode> = {\n  [M in keyof Params<B>]?: {\n    [name: string]: (...args: [Partial<ReturnType<Params<B>[M]>>, ...Parameters<Params<B>[M]>]) => void;\n  }\n}\n\ntype Customizers<B extends BidderCode> = {\n  [M in keyof Params<B>]?: (buildObject: Params<B>[M], ...args: Parameters<Params<B>[M]>) => ReturnType<Params<B>[M]>;\n}\n\ntype Overrides<B extends BidderCode> = {\n  [M in keyof Params<B>]?: {\n    [name: string]: (orig: Processors<B>[M][string], ...args: Parameters<Processors<B>[M][string]>) => void;\n  }\n}\n\ntype ConverterConfig<B extends BidderCode> = Customizers<B> & {\n  context?: Context;\n  processors?: () => Processors<B>;\n  overrides?: Overrides<B>;\n}\n\nexport function ortbConverter<B extends BidderCode>({\n  context: defaultContext = {},\n  processors = defaultProcessors,\n  overrides = {},\n  imp,\n  request,\n  bidResponse,\n  response,\n}: ConverterConfig<B> = {}) {\n  const REQ_CTX = new WeakMap();\n\n  function builder(slot, wrapperFn, builderFn, errorHandler) {\n    let build;\n    return function (...args) {\n      if (build == null) {\n        build = (function () {\n          let delegate = builderFn.bind(this, compose(processors()[slot] || {}, overrides[slot] || {}));\n          if (wrapperFn) {\n            delegate = wrapperFn.bind(this, delegate);\n          }\n          return function (...args) {\n            try {\n              return delegate.apply(this, args);\n            } catch (e) {\n              errorHandler.call(this, e, ...args);\n            }\n          }\n        })();\n      }\n      return build.apply(this, args);\n    }\n  }\n\n  const buildImp = builder(IMP, imp,\n    function (process, bidRequest, context) {\n      const imp = {};\n      process(imp, bidRequest, context);\n      return imp;\n    },\n    function (error, bidRequest, context) {\n      logError('Error while converting bidRequest to ORTB imp; request skipped.', {error, bidRequest, context});\n    }\n  );\n\n  const buildRequest = builder(REQUEST, request,\n    function (process, imps, bidderRequest, context) {\n      const ortbRequest = {imp: imps};\n      process(ortbRequest, bidderRequest, context);\n      return ortbRequest;\n    },\n    function (error, imps, bidderRequest, context) {\n      logError('Error while converting to ORTB request', {error, imps, bidderRequest, context});\n      throw error;\n    }\n  );\n\n  const buildBidResponse = builder(BID_RESPONSE, bidResponse,\n    function (process, bid, context) {\n      const bidResponse = {};\n      process(bidResponse, bid, context);\n      return bidResponse;\n    },\n    function (error, bid, context) {\n      logError('Error while converting ORTB seatbid.bid to bidResponse; bid skipped.', {error, bid, context});\n    }\n  );\n\n  const buildResponse = builder(RESPONSE, response,\n    function (process, bidResponses, ortbResponse, context) {\n      const response = {bids: bidResponses};\n      process(response, ortbResponse, context);\n      return response;\n    },\n    function (error, bidResponses, ortbResponse, context) {\n      logError('Error while converting from ORTB response', {error, bidResponses, ortbResponse, context});\n      throw error;\n    }\n  );\n\n  return {\n    toORTB({bidderRequest, bidRequests, context = {}}: {\n      bidderRequest: BidderRequest<B>,\n      bidRequests?: BidRequest<B>[],\n      context?: Context\n    }): ORTBRequest {\n      bidRequests = bidRequests || bidderRequest.bids;\n      const ctx = {\n        req: Object.assign({bidRequests}, defaultContext, context),\n        imp: {}\n      }\n      ctx.req.impContext = ctx.imp;\n      const imps = bidRequests.map(bidRequest => {\n        const impContext = Object.assign({bidderRequest, reqContext: ctx.req}, defaultContext, context);\n        const result = buildImp(bidRequest, impContext);\n        if (result != null) {\n          if (result.hasOwnProperty('id')) {\n            Object.assign(impContext, {bidRequest, imp: result});\n            ctx.imp[result.id] = impContext;\n            return result;\n          }\n          logError('Converted ORTB imp does not specify an id, ignoring bid request', bidRequest, result);\n        }\n        return undefined;\n      }).filter(Boolean);\n\n      const request = buildRequest(imps, bidderRequest, ctx.req);\n      ctx.req.bidderRequest = bidderRequest;\n      if (request != null) {\n        REQ_CTX.set(request, ctx);\n      }\n      return request;\n    },\n    fromORTB({request, response}: {\n      request: ORTBRequest;\n      response: ORTBResponse | null;\n    }): AdapterResponse {\n      const ctx = REQ_CTX.get(request);\n      if (ctx == null) {\n        throw new Error('ortbRequest passed to `fromORTB` must be the same object returned by `toORTB`')\n      }\n      function augmentContext(ctx, extraParams = {}) {\n        return Object.assign(ctx, {ortbRequest: request}, extraParams);\n      }\n      const impsById = Object.fromEntries((request.imp || []).map(imp => [imp.id, imp]));\n      const bidResponses = (response?.seatbid || []).flatMap(seatbid =>\n        (seatbid.bid || []).map((bid) => {\n          if (impsById.hasOwnProperty(bid.impid) && ctx.imp.hasOwnProperty(bid.impid)) {\n            return buildBidResponse(bid, augmentContext(ctx.imp[bid.impid], {imp: impsById[bid.impid], seatbid, ortbResponse: response}));\n          }\n          logError('ORTB response seatbid[].bid[].impid does not match any imp in request; ignoring bid', bid);\n          return undefined;\n        })\n      ).filter(Boolean);\n      return buildResponse(bidResponses, response, augmentContext(ctx.req));\n    }\n  }\n}\n\nexport const defaultProcessors = memoize(() => mergeProcessors(DEFAULT_PROCESSORS, getProcessors(DEFAULT)));\n","const SORTED = new WeakMap();\n\n/**\n * @typedef {Object} Component\n * A component function, that can be composed with other compatible functions into one.\n * Compatible functions take the same arguments; return values are ignored.\n *\n * @property {function} fn the component function;\n * @property {number} priority determines the order in which this function will run when composed with others.\n */\n\n/**\n *\n * @param {Object.<string, Component>} components - An object where keys are component names and values are components to compose.\n * @param {Object.<string, (function|boolean)>} overrides - A map from component names to functions that should override those components.\n * Override functions are replacements, except that they get the original function they are overriding as their first argument. If the override\n * is `false`, the component is disabled.\n *\n * @return {function} - A function that will run all components in order of priority, with functions from `overrides` taking\n * precedence over components that match names.\n */\nexport function compose(components, overrides = {}) {\n  if (!SORTED.has(components)) {\n    const sorted = Object.entries(components);\n    sorted.sort((a, b) => {\n      a = a[1].priority || 0;\n      b = b[1].priority || 0;\n      return a === b ? 0 : a > b ? -1 : 1\n    });\n    SORTED.set(components, sorted.map(([name, cmp]) => [name, cmp.fn]))\n  }\n  const fns = SORTED.get(components)\n    .filter(([name]) => !overrides.hasOwnProperty(name) || overrides[name])\n    .map(function ([name, fn]) {\n      return overrides.hasOwnProperty(name) ? overrides[name].bind(this, fn) : fn;\n    });\n  return function () {\n    const args = Array.from(arguments);\n    fns.forEach(fn => {\n      fn.apply(this, args);\n    })\n  }\n}\n","import {PROCESSOR_TYPES} from '../../../src/pbjsORTB.js';\n\nexport function mergeProcessors(...processors) {\n  const left = processors.shift();\n  const right = processors.length > 1 ? mergeProcessors(...processors) : processors[0];\n  return Object.fromEntries(\n    PROCESSOR_TYPES.map(type => [type, Object.assign({}, left[type], right[type])])\n  )\n}\n","import { AUDIO } from '../../../src/mediaTypes.js';\nimport { isEmpty, mergeDeep } from '../../../src/utils.js';\n\nimport { ORTB_AUDIO_PARAMS } from '../../../src/audio.js';\n\nexport function fillAudioImp(imp, bidRequest, context) {\n  if (context.mediaType && context.mediaType !== AUDIO) return;\n\n  const audioParams = bidRequest?.mediaTypes?.audio;\n  if (!isEmpty(audioParams)) {\n    const audio = Object.fromEntries(\n      // Parameters that share the same name & semantics between pbjs adUnits and imp.audio\n      Object.entries(audioParams)\n        .filter(([name]) => ORTB_AUDIO_PARAMS.has(name))\n    );\n\n    imp.audio = mergeDeep(audio, imp.audio);\n  }\n}\n\nexport function fillAudioResponse(bidResponse, seatbid) {\n  if (bidResponse.mediaType === AUDIO) {\n    if (seatbid.adm) { bidResponse.vastXml = seatbid.adm; }\n    if (seatbid.nurl) { bidResponse.vastUrl = seatbid.nurl; }\n  }\n}\n","import {\n  createTrackPixelHtml,\n  inIframe,\n  mergeDeep,\n  sizesToSizeTuples,\n  sizeTupleToRtbSize,\n  encodeMacroURI\n} from '../../../src/utils.js';\nimport {BANNER} from '../../../src/mediaTypes.js';\n\n/**\n * fill in a request `imp` with banner parameters from `bidRequest`.\n */\nexport function fillBannerImp(imp, bidRequest, context) {\n  if (context.mediaType && context.mediaType !== BANNER) return;\n\n  const bannerParams = bidRequest?.mediaTypes?.banner;\n  if (bannerParams) {\n    const banner = {\n      topframe: inIframe() === true ? 0 : 1\n    };\n    if (bannerParams.sizes && bidRequest.ortb2Imp?.banner?.format == null) {\n      banner.format = sizesToSizeTuples(bannerParams.sizes).map(sizeTupleToRtbSize);\n    }\n    if (bannerParams.hasOwnProperty('pos')) {\n      banner.pos = bannerParams.pos;\n    }\n\n    imp.banner = mergeDeep(banner, imp.banner);\n  }\n}\n\nexport function bannerResponseProcessor({createPixel = (url) => createTrackPixelHtml(decodeURIComponent(url), encodeMacroURI)} = {}) {\n  return function fillBannerResponse(bidResponse, bid) {\n    if (bidResponse.mediaType === BANNER) {\n      if (bid.adm && bid.nurl) {\n        bidResponse.ad = createPixel(bid.nurl) + bid.adm;\n      } else if (bid.adm) {\n        bidResponse.ad = bid.adm;\n      } else if (bid.nurl) {\n        bidResponse.adUrl = bid.nurl;\n      }\n    }\n  };\n}\n","import {generateUUID, mergeDeep} from '../../../src/utils.js';\nimport {bannerResponseProcessor, fillBannerImp} from './banner.js';\nimport {fillVideoImp, fillVideoResponse} from './video.js';\nimport {setResponseMediaType} from './mediaType.js';\nimport {fillNativeImp, fillNativeResponse} from './native.js';\nimport {BID_RESPONSE, IMP, REQUEST} from '../../../src/pbjsORTB.js';\nimport {clientSectionChecker} from '../../../src/fpd/oneClient.js';\nimport { fillAudioImp, fillAudioResponse } from './audio.js';\n\nexport const DEFAULT_PROCESSORS = {\n  [REQUEST]: {\n    fpd: {\n      // sets initial request to bidderRequest.ortb2\n      priority: 99,\n      fn(ortbRequest, bidderRequest) {\n        mergeDeep(ortbRequest, bidderRequest.ortb2)\n      }\n    },\n    onlyOneClient: {\n      // make sure only one of 'dooh', 'app', 'site' is set in request\n      priority: -99,\n      fn: clientSectionChecker('ORTB request')\n    },\n    props: {\n      // sets request properties id, tmax, test\n      fn(ortbRequest, bidderRequest) {\n        Object.assign(ortbRequest, {\n          id: ortbRequest.id || generateUUID(),\n          test: ortbRequest.test || 0\n        });\n        const timeout = parseInt(bidderRequest.timeout, 10);\n        if (!isNaN(timeout)) {\n          ortbRequest.tmax = timeout;\n        }\n      }\n    }\n  },\n  [IMP]: {\n    fpd: {\n      // sets initial imp to bidRequest.ortb2Imp\n      priority: 99,\n      fn(imp, bidRequest) {\n        mergeDeep(imp, bidRequest.ortb2Imp);\n      }\n    },\n    id: {\n      // sets imp.id\n      fn(imp, bidRequest) {\n        imp.id = bidRequest.bidId;\n      }\n    },\n    banner: {\n      // populates imp.banner\n      fn: fillBannerImp\n    },\n    secure: {\n      // should set imp.secure to 1 unless publisher has set it\n      fn(imp, bidRequest) {\n        imp.secure = imp.secure ?? 1;\n      }\n    }\n  },\n  [BID_RESPONSE]: {\n    mediaType: {\n      // sets bidResponse.mediaType from context.mediaType, falling back to seatbid.bid[].mtype\n      priority: 99,\n      fn: setResponseMediaType\n    },\n    banner: {\n      // sets banner response attributes if bidResponse.mediaType === BANNER\n      fn: bannerResponseProcessor(),\n    },\n    props: {\n      // sets base bidResponse properties common to all types of bids\n      fn(bidResponse, bid, context) {\n        Object.entries({\n          requestId: context.bidRequest?.bidId,\n          seatBidId: bid.id,\n          cpm: bid.price,\n          currency: context.ortbResponse.cur || context.currency,\n          width: bid.w,\n          height: bid.h,\n          wratio: bid.wratio,\n          hratio: bid.hratio,\n          dealId: bid.dealid,\n          creative_id: bid.crid,\n          creativeId: bid.crid,\n          burl: bid.burl,\n          ttl: bid.exp || context.ttl,\n          netRevenue: context.netRevenue,\n        }).filter(([k, v]) => typeof v !== 'undefined')\n          .forEach(([k, v]) => {\n            bidResponse[k] = v;\n          });\n        if (!bidResponse.meta) {\n          bidResponse.meta = {};\n        }\n        if (bid.adomain) {\n          bidResponse.meta.advertiserDomains = bid.adomain;\n        }\n        if (bid.ext?.dsa) {\n          bidResponse.meta.dsa = bid.ext.dsa;\n        }\n        if (bid.cat) {\n          bidResponse.meta.primaryCatId = bid.cat[0];\n          bidResponse.meta.secondaryCatIds = bid.cat.slice(1);\n        }\n        if (bid.attr) {\n          bidResponse.meta.attr = bid.attr;\n        }\n        if (bid.ext?.eventtrackers) {\n          bidResponse.eventtrackers = (bidResponse.eventtrackers ?? []).concat(bid.ext.eventtrackers);\n        }\n      }\n    }\n  }\n}\n\nif (FEATURES.NATIVE) {\n  DEFAULT_PROCESSORS[IMP].native = {\n    // populates imp.native\n    fn: fillNativeImp\n  }\n  DEFAULT_PROCESSORS[BID_RESPONSE].native = {\n    // populates bidResponse.native if bidResponse.mediaType === NATIVE\n    fn: fillNativeResponse\n  }\n}\n\nif (FEATURES.VIDEO) {\n  DEFAULT_PROCESSORS[IMP].video = {\n    // populates imp.video\n    fn: fillVideoImp\n  }\n  DEFAULT_PROCESSORS[BID_RESPONSE].video = {\n    // sets video response attributes if bidResponse.mediaType === VIDEO\n    fn: fillVideoResponse\n  }\n}\n\nif (FEATURES.AUDIO) {\n  DEFAULT_PROCESSORS[IMP].audio = {\n    // populates imp.audio\n    fn: fillAudioImp\n  }\n  DEFAULT_PROCESSORS[BID_RESPONSE].audio = {\n    // sets video response attributes if bidResponse.mediaType === AUDIO\n    fn: fillAudioResponse\n  }\n}\n","import {BANNER, NATIVE, VIDEO} from '../../../src/mediaTypes.js';\n\nexport const ORTB_MTYPES = {\n  1: BANNER,\n  2: VIDEO,\n  4: NATIVE\n}\n\n/**\n * Sets response mediaType, using ORTB 2.6 `seatbid.bid[].mtype`.\n *\n * Note that this will throw away bids if there is no `mtype` in the response.\n */\nexport function setResponseMediaType(bidResponse, bid, context) {\n  if (bidResponse.mediaType) return;\n  const mediaType = context.mediaType;\n  if (!mediaType && !ORTB_MTYPES.hasOwnProperty(bid.mtype)) {\n    throw new Error('Cannot determine mediaType for response')\n  }\n  bidResponse.mediaType = mediaType || ORTB_MTYPES[bid.mtype];\n}\n","import {isPlainObject, logWarn, mergeDeep} from '../../../src/utils.js';\nimport {NATIVE} from '../../../src/mediaTypes.js';\n\nexport function fillNativeImp(imp, bidRequest, context) {\n  if (context.mediaType && context.mediaType !== NATIVE) return;\n  let nativeReq = bidRequest.nativeOrtbRequest;\n  if (nativeReq) {\n    nativeReq = Object.assign({}, context.nativeRequest, nativeReq);\n    if (nativeReq.assets?.length) {\n      imp.native = mergeDeep({}, {\n        request: JSON.stringify(nativeReq),\n        ver: nativeReq.ver\n      }, imp.native)\n    } else {\n      logWarn('mediaTypes.native is set, but no assets were specified. Native request skipped.', bidRequest)\n    }\n  }\n}\n\nexport function fillNativeResponse(bidResponse, bid) {\n  if (bidResponse.mediaType === NATIVE) {\n    let ortb;\n    if (typeof bid.adm === 'string') {\n      ortb = JSON.parse(bid.adm);\n    } else {\n      ortb = bid.adm;\n    }\n\n    if (isPlainObject(ortb) && Array.isArray(ortb.assets)) {\n      bidResponse.native = {\n        ortb,\n      }\n    } else {\n      throw new Error('ORTB native response contained no assets');\n    }\n  }\n}\n","import {isEmpty, logWarn, mergeDeep, sizesToSizeTuples, sizeTupleToRtbSize} from '../../../src/utils.js';\nimport {VIDEO} from '../../../src/mediaTypes.js';\n\nimport {ORTB_VIDEO_PARAMS} from '../../../src/video.js';\n\nexport function fillVideoImp(imp, bidRequest, context) {\n  if (context.mediaType && context.mediaType !== VIDEO) return;\n\n  const videoParams = bidRequest?.mediaTypes?.video;\n  if (!isEmpty(videoParams)) {\n    const video = Object.fromEntries(\n      // Parameters that share the same name & semantics between pbjs adUnits and imp.video\n      Object.entries(videoParams)\n        .filter(([name]) => ORTB_VIDEO_PARAMS.has(name))\n    );\n    if (videoParams.playerSize) {\n      const format = sizesToSizeTuples(videoParams.playerSize).map(sizeTupleToRtbSize);\n      if (format.length > 1) {\n        logWarn('video request specifies more than one playerSize; all but the first will be ignored')\n      }\n      Object.assign(video, format[0]);\n    }\n\n    imp.video = mergeDeep(video, imp.video);\n  }\n}\n\nexport function fillVideoResponse(bidResponse, seatbid, context) {\n  if (bidResponse.mediaType === VIDEO) {\n    if (context?.imp?.video?.w && context?.imp?.video?.h) {\n      [bidResponse.playerWidth, bidResponse.playerHeight] = [context.imp.video.w, context.imp.video.h];\n    }\n\n    if (seatbid.adm) { bidResponse.vastXml = seatbid.adm; }\n    if (seatbid.nurl) { bidResponse.vastUrl = seatbid.nurl; }\n  }\n}\n"],"names":["compose","logError","memoize","DEFAULT_PROCESSORS","BID_RESPONSE","DEFAULT","getProcessors","IMP","REQUEST","RESPONSE","mergeProcessors","ortbConverter","context","defaultContext","processors","defaultProcessors","overrides","imp","request","bidResponse","response","arguments","length","undefined","REQ_CTX","WeakMap","builder","slot","wrapperFn","builderFn","errorHandler","build","delegate","bind","_len2","args","Array","_key2","apply","e","call","_len","_key","buildImp","process","bidRequest","error","buildRequest","imps","bidderRequest","ortbRequest","buildBidResponse","bid","buildResponse","bidResponses","ortbResponse","bids","toORTB","_ref","bidRequests","ctx","req","Object","assign","impContext","map","reqContext","result","hasOwnProperty","id","filter","Boolean","set","fromORTB","_ref2","get","Error","augmentContext","extraParams","impsById","fromEntries","seatbid","flatMap","impid","SORTED","components","has","sorted","entries","sort","a","b","priority","name","cmp","fn","fns","_ref3","from","forEach","PROCESSOR_TYPES","left","shift","right","type","AUDIO","isEmpty","mergeDeep","ORTB_AUDIO_PARAMS","fillAudioImp","_bidRequest$mediaType","mediaType","audioParams","mediaTypes","audio","fillAudioResponse","adm","vastXml","nurl","vastUrl","createTrackPixelHtml","inIframe","sizesToSizeTuples","sizeTupleToRtbSize","encodeMacroURI","BANNER","fillBannerImp","bannerParams","banner","_bidRequest$ortb2Imp","topframe","sizes","ortb2Imp","format","pos","bannerResponseProcessor","createPixel","url","decodeURIComponent","fillBannerResponse","ad","adUrl","generateUUID","fillVideoImp","fillVideoResponse","setResponseMediaType","fillNativeImp","fillNativeResponse","clientSectionChecker","fpd","ortb2","onlyOneClient","props","test","timeout","parseInt","isNaN","tmax","bidId","secure","_imp$secure","_context$bidRequest","_bid$ext","_bid$ext2","requestId","seatBidId","cpm","price","currency","cur","width","w","height","h","wratio","hratio","dealId","dealid","creative_id","crid","creativeId","burl","ttl","exp","netRevenue","k","v","meta","adomain","advertiserDomains","ext","dsa","cat","primaryCatId","secondaryCatIds","slice","attr","eventtrackers","_bidResponse$eventtra","concat","native","video","NATIVE","VIDEO","ORTB_MTYPES","mtype","isPlainObject","logWarn","nativeReq","nativeOrtbRequest","_nativeReq$assets","nativeRequest","assets","JSON","stringify","ver","ortb","parse","isArray","ORTB_VIDEO_PARAMS","videoParams","playerSize","_context$imp","_context$imp2","playerWidth","playerHeight"],"sourceRoot":""}