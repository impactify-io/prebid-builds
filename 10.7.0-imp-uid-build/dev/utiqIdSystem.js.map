{"version":3,"file":"utiqIdSystem.js","mappings":"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","sources":["webpack://prebid.js/../../modules/utiqIdSystem.js"],"sourcesContent":["/**\n * This module adds Utiq provided by Utiq SA/NV to the User ID module\n * The {@link module:modules/userId} module is required\n * @module modules/utiqIdSystem\n * @requires module:modules/userId\n */\nimport { logInfo } from '../src/utils.js';\nimport { submodule } from '../src/hook.js';\nimport { getStorageManager } from '../src/storageManager.js';\nimport { MODULE_TYPE_UID } from '../src/activities/modules.js';\n\n/**\n * @typedef {import('../modules/userId/index.js').Submodule} Submodule\n */\n\nconst MODULE_NAME = 'utiqId';\nconst LOG_PREFIX = 'Utiq module';\n\nexport const storage = getStorageManager({\n  moduleType: MODULE_TYPE_UID,\n  moduleName: MODULE_NAME,\n});\n\n/**\n * Get the \"atid\" from html5 local storage to make it available to the UserId module.\n * @returns {{utiq: (*|string)}}\n */\nfunction getUtiqFromStorage() {\n  let utiqPass;\n  const utiqPassStorage = JSON.parse(\n    storage.getDataFromLocalStorage('utiqPass')\n  );\n\n  const netIdAdtechpass = storage.getDataFromLocalStorage('netid_utiq_adtechpass');\n\n  if (netIdAdtechpass) {\n    logInfo(\n      `${LOG_PREFIX}: Local storage netid_utiq_adtechpass: ${netIdAdtechpass}`\n    );\n    return {\n      utiq: netIdAdtechpass,\n    }\n  }\n\n  if (\n    utiqPassStorage &&\n    utiqPassStorage.connectId &&\n    Array.isArray(utiqPassStorage.connectId.idGraph) &&\n    utiqPassStorage.connectId.idGraph.length > 0\n  ) {\n    utiqPass = utiqPassStorage.connectId.idGraph[0];\n\n    logInfo(\n      `${LOG_PREFIX}: Local storage utiqPass: ${JSON.stringify(\n        utiqPassStorage\n      )}`\n    );\n\n    logInfo(\n      `${LOG_PREFIX}: Graph of utiqPass: ${JSON.stringify(\n        utiqPass\n      )}`\n    );\n  }\n\n  return {\n    utiq:\n      utiqPass && utiqPass.atid\n        ? utiqPass.atid\n        : null,\n  };\n}\n\n/** @type {Submodule} */\nexport const utiqIdSubmodule = {\n  /**\n   * Used to link submodule with config\n   * @type {string}\n   */\n  name: MODULE_NAME,\n  /**\n   * Decodes the stored id value for passing to bid requests.\n   * @function\n   * @returns {{utiq: string} | null}\n   */\n  decode(bidId) {\n    logInfo(`${LOG_PREFIX}: Decoded ID value ${JSON.stringify(bidId)}`);\n    return bidId.utiq ? bidId : null;\n  },\n  /**\n   * Get the id from helper function and initiate a new user sync.\n   * @param config\n   * @returns {{callback: Function}|{id: {utiq: string}}}\n   */\n  getId: function (config) {\n    const data = getUtiqFromStorage();\n    if (data.utiq) {\n      logInfo(`${LOG_PREFIX}: Local storage ID value ${JSON.stringify(data)}`);\n      return { id: { utiq: data.utiq } };\n    } else {\n      if (!config) {\n        config = {};\n      }\n      if (!config.params) {\n        config.params = {};\n      }\n      if (\n        typeof config.params.maxDelayTime === 'undefined' ||\n        config.params.maxDelayTime === null\n      ) {\n        config.params.maxDelayTime = 1000;\n      }\n      // Current delay and delay step in milliseconds\n      let currentDelay = 0;\n      const delayStep = 50;\n      const result = (callback) => {\n        const data = getUtiqFromStorage();\n        if (!data.utiq) {\n          if (currentDelay > config.params.maxDelayTime) {\n            logInfo(\n              `${LOG_PREFIX}: No utiq value set after ${config.params.maxDelayTime} max allowed delay time`\n            );\n            callback(null);\n          } else {\n            currentDelay += delayStep;\n            setTimeout(() => {\n              result(callback);\n            }, delayStep);\n          }\n        } else {\n          const dataToReturn = { utiq: data.utiq };\n          logInfo(\n            `${LOG_PREFIX}: Returning ID value data of ${JSON.stringify(\n              dataToReturn\n            )}`\n          );\n          callback(dataToReturn);\n        }\n      };\n      return { callback: result };\n    }\n  },\n  eids: {\n    'utiq': {\n      source: 'utiq.com',\n      atype: 1,\n      getValue: function (data) {\n        return data;\n      },\n    },\n  }\n};\n\nsubmodule('userId', utiqIdSubmodule);\n"],"names":["registerModule","__r0","logInfo","submodule","getStorageManager","MODULE_TYPE_UID","MODULE_NAME","LOG_PREFIX","storage","moduleType","moduleName","getUtiqFromStorage","utiqPass","utiqPassStorage","JSON","parse","getDataFromLocalStorage","netIdAdtechpass","utiq","connectId","Array","isArray","idGraph","length","stringify","atid","utiqIdSubmodule","name","decode","bidId","getId","config","data","id","params","maxDelayTime","currentDelay","delayStep","result","callback","setTimeout","dataToReturn","eids","source","atype","getValue"],"sourceRoot":""}