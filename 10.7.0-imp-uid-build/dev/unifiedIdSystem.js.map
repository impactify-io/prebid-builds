{"version":3,"file":"unifiedIdSystem.js","mappings":";;;;;;;;;;;;;;;AAA6D;AAA7D;AACA;AACA;AACA;AACA;AACA;;AAE2C;AACP;AACI;AACoB;;AAE5D;AACA;AACA;AACA;AACA;;AAEA,MAAMM,WAAW,GAAG,WAAW;;AAE/B;AACO,MAAMC,kBAAkB,GAAG;EAChC;AACF;AACA;AACA;EACEC,IAAI,EAAEF,WAAW;EACjB;AACF;AACA;EACEG,KAAK,EAAE,EAAE;EACT;AACF;AACA;AACA;AACA;AACA;EACEC,MAAMA,CAACC,KAAK,EAAE;IACZ,OAAQA,KAAK,IAAI,OAAOA,KAAK,CAAC,MAAM,CAAC,KAAK,QAAQ,GAAI;MAAE,MAAM,EAAEA,KAAK,CAAC,MAAM;IAAE,CAAC,GAAGC,SAAS;EAC7F,CAAC;EACD;AACF;AACA;AACA;AACA;AACA;EACEC,KAAKA,CAACC,MAAM,EAAE;IACZ,MAAMC,YAAY,GAAID,MAAM,IAAIA,MAAM,CAACE,MAAM,IAAK,CAAC,CAAC;IACpD,IAAI,CAACD,YAAY,IAAK,OAAOA,YAAY,CAACE,OAAO,KAAK,QAAQ,IAAI,OAAOF,YAAY,CAACG,GAAG,KAAK,QAAS,EAAE;MACvGhB,uDAAQ,CAAC,4EAA4E,CAAC;MACtF;IACF;IACA;IACA,MAAMgB,GAAG,GAAGH,YAAY,CAACG,GAAG,IAAI,8CAA8CH,YAAY,CAACE,OAAO,WAAW;IAE7G,MAAME,IAAI,GAAG,SAAAA,CAAUC,QAAQ,EAAE;MAC/B,MAAMC,SAAS,GAAG;QAChBC,OAAO,EAAEC,QAAQ,IAAI;UACnB,IAAIC,WAAW;UACf,IAAID,QAAQ,EAAE;YACZ,IAAI;cACFC,WAAW,GAAGC,IAAI,CAACC,KAAK,CAACH,QAAQ,CAAC;YACpC,CAAC,CAAC,OAAOI,KAAK,EAAE;cACdzB,uDAAQ,CAACyB,KAAK,CAAC;YACjB;UACF;UACAP,QAAQ,CAACI,WAAW,CAAC;QACvB,CAAC;QACDG,KAAK,EAAEA,KAAK,IAAI;UACdzB,uDAAQ,CAAC,GAAGI,WAAW,iCAAiC,EAAEqB,KAAK,CAAC;UAChEP,QAAQ,CAAC,CAAC;QACZ;MACF,CAAC;MACDjB,kDAAI,CAACe,GAAG,EAAEG,SAAS,EAAET,SAAS,EAAE;QAACgB,MAAM,EAAE,KAAK;QAAEC,eAAe,EAAE;MAAI,CAAC,CAAC;IACzE,CAAC;IACD,OAAO;MAACT,QAAQ,EAAED;IAAI,CAAC;EACzB,CAAC;EACDW,IAAI,EAAE;IACJC,IAAI,EAAE;MACJ,GAAG1B,sEAAS,CAAC0B,IAAI;MACjBC,EAAE,EAAE,CAAC;MACLC,QAAQ,EAAE,cAAc;MACxBC,OAAO,EAAE;IACX;EACF;AACF,CAAC;AAED9B,uDAAS,CAAC,QAAQ,EAAEG,kBAAkB,CAAC;AAvFvCN,oEAAI,CAAC,iBAAiB,CAAC","sources":["webpack://prebid.js/../../modules/unifiedIdSystem.js"],"sourcesContent":["/**\n * This module adds UnifiedId to the User ID module\n * The {@link module:modules/userId} module is required\n * @module modules/unifiedIdSystem\n * @requires module:modules/userId\n */\n\nimport { logError } from '../src/utils.js';\nimport {ajax} from '../src/ajax.js';\nimport {submodule} from '../src/hook.js'\nimport {UID1_EIDS} from '../libraries/uid1Eids/uid1Eids.js';\n\n/**\n * @typedef {import('../modules/userId/index.js').Submodule} Submodule\n * @typedef {import('../modules/userId/index.js').SubmoduleConfig} SubmoduleConfig\n * @typedef {import('../modules/userId/index.js').IdResponse} IdResponse\n */\n\nconst MODULE_NAME = 'unifiedId';\n\n/** @type {Submodule} */\nexport const unifiedIdSubmodule = {\n  /**\n   * used to link submodule with config\n   * @type {string}\n   */\n  name: MODULE_NAME,\n  /**\n   * required for the gdpr enforcement module\n   */\n  gvlid: 21,\n  /**\n   * decode the stored id value for passing to bid requests\n   * @function\n   * @param {{TDID:string}} value\n   * @returns {{tdid:Object}}\n   */\n  decode(value) {\n    return (value && typeof value['TDID'] === 'string') ? { 'tdid': value['TDID'] } : undefined;\n  },\n  /**\n   * performs action to obtain id and return a value in the callback's response argument\n   * @function\n   * @param {SubmoduleConfig} [config]\n   * @returns {IdResponse|undefined}\n   */\n  getId(config) {\n    const configParams = (config && config.params) || {};\n    if (!configParams || (typeof configParams.partner !== 'string' && typeof configParams.url !== 'string')) {\n      logError('User ID - unifiedId submodule requires either partner or url to be defined');\n      return;\n    }\n    // use protocol relative urls for http or https\n    const url = configParams.url || `https://match.adsrvr.org/track/rid?ttd_pid=${configParams.partner}&fmt=json`;\n\n    const resp = function (callback) {\n      const callbacks = {\n        success: response => {\n          let responseObj;\n          if (response) {\n            try {\n              responseObj = JSON.parse(response);\n            } catch (error) {\n              logError(error);\n            }\n          }\n          callback(responseObj);\n        },\n        error: error => {\n          logError(`${MODULE_NAME}: ID fetch encountered an error`, error);\n          callback();\n        }\n      };\n      ajax(url, callbacks, undefined, {method: 'GET', withCredentials: true});\n    };\n    return {callback: resp};\n  },\n  eids: {\n    tdid: {\n      ...UID1_EIDS.tdid,\n      mm: 4,\n      inserter: 'adserver.org',\n      matcher: 'adserver.org'\n    }\n  }\n};\n\nsubmodule('userId', unifiedIdSubmodule);\n"],"names":["registerModule","__r0","logError","ajax","submodule","UID1_EIDS","MODULE_NAME","unifiedIdSubmodule","name","gvlid","decode","value","undefined","getId","config","configParams","params","partner","url","resp","callback","callbacks","success","response","responseObj","JSON","parse","error","method","withCredentials","eids","tdid","mm","inserter","matcher"],"sourceRoot":""}