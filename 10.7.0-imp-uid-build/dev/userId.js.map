{"version":3,"file":"userId.js","mappings":"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","sources":["webpack://prebid.js/../../modules/userId/eids.js","webpack://prebid.js/../../modules/userId/index.ts"],"sourcesContent":["import {logError, deepClone, isFn, isStr} from '../../src/utils.js';\n\nexport const EID_CONFIG = new Map();\n\n// this function will create an eid object for the given UserId sub-module\nfunction createEidObject(userIdData, subModuleKey, eidConf) {\n  if (eidConf && userIdData) {\n    const eid = {};\n    eid.source = isFn(eidConf['getSource']) ? eidConf['getSource'](userIdData) : eidConf['source'];\n    const value = isFn(eidConf['getValue']) ? eidConf['getValue'](userIdData) : userIdData;\n    if (isStr(value)) {\n      const uid = { id: value, atype: eidConf['atype'] };\n      // getUidExt\n      if (isFn(eidConf['getUidExt'])) {\n        const uidExt = eidConf['getUidExt'](userIdData);\n        if (uidExt) {\n          uid.ext = uidExt;\n        }\n      }\n      eid.uids = [uid];\n      if (eidConf['inserter'] || isFn(eidConf['getInserter'])) {\n        const inserter = isFn(eidConf['getInserter']) ? eidConf['getInserter'](userIdData) : eidConf['inserter'];\n        if (inserter != null) {\n          eid.inserter = inserter;\n        }\n      }\n      if (eidConf['matcher'] || isFn(eidConf['getMatcher'])) {\n        const matcher = isFn(eidConf['getMatcher']) ? eidConf['getMatcher'](userIdData) : eidConf['matcher'];\n        if (matcher != null) {\n          eid.matcher = matcher;\n        }\n      }\n      if (eidConf['mm'] != null) {\n        eid.mm = eidConf['mm'];\n      }\n      // getEidExt\n      if (isFn(eidConf['getEidExt'])) {\n        const eidExt = eidConf['getEidExt'](userIdData);\n        if (eidExt) {\n          eid.ext = eidExt;\n        }\n      }\n      return eid;\n    }\n  }\n  return null;\n}\n\nexport function createEidsArray(bidRequestUserId, eidConfigs = EID_CONFIG) {\n  const allEids = {};\n  function collect(eid) {\n    const key = JSON.stringify([\n      eid.source?.toLowerCase(),\n      ...Object.keys(eid).filter(k => !['uids', 'source'].includes(k)).sort().map(k => eid[k])\n    ]);\n    if (allEids.hasOwnProperty(key)) {\n      allEids[key].uids.push(...eid.uids);\n    } else {\n      allEids[key] = eid;\n    }\n  }\n\n  Object.entries(bidRequestUserId).forEach(([name, values]) => {\n    values = Array.isArray(values) ? values : [values];\n    const eidConf = eidConfigs.get(name);\n    let eids;\n    if (name === 'pubProvidedId') {\n      eids = deepClone(values);\n    } else if (typeof eidConf === 'function') {\n      try {\n        eids = eidConf(values);\n        if (!Array.isArray(eids)) {\n          eids = [eids];\n        }\n        eids.forEach(eid => {\n          eid.uids = eid.uids.filter(({id}) => isStr(id))\n        })\n        eids = eids.filter(({uids}) => uids?.length > 0);\n      } catch (e) {\n        logError(`Could not generate EID for \"${name}\"`, e);\n      }\n    } else {\n      eids = values.map(value => createEidObject(value, name, eidConf));\n    }\n    if (Array.isArray(eids)) {\n      eids.filter(eid => eid != null).forEach(collect);\n    }\n  })\n  return Object.values(allEids);\n}\n\nexport function getEids(priorityMap) {\n  const eidConfigs = new Map();\n  const idValues = {};\n  Object.entries(priorityMap).forEach(([key, getActiveModule]) => {\n    const submodule = getActiveModule();\n    if (submodule) {\n      idValues[key] = submodule.idObj[key];\n      let eidConf = submodule.submodule.eids?.[key];\n      if (typeof eidConf === 'function') {\n        // if eid config is given as a function, append the active module configuration to its args\n        eidConf = ((orig) => (...args) => orig(...args, submodule.config))(eidConf);\n      }\n      eidConfigs.set(key, eidConf);\n    }\n  })\n  return createEidsArray(idValues, eidConfigs);\n}\n","/**\n * This module adds User ID support to prebid.js\n * @module modules/userId\n */\n\nimport {config} from '../../src/config.js';\nimport * as events from '../../src/events.js';\nimport {addApiMethod, startAuction, type StartAuctionOptions} from '../../src/prebid.js';\nimport adapterManager from '../../src/adapterManager.js';\nimport {EVENTS} from '../../src/constants.js';\nimport {module, ready as hooksReady} from '../../src/hook.js';\nimport {EID_CONFIG, getEids} from './eids.js';\nimport {\n  discloseStorageUse,\n  getCoreStorageManager,\n  newStorageManager,\n  STORAGE_TYPE_COOKIES,\n  STORAGE_TYPE_LOCALSTORAGE,\n  type StorageManager,\n  type StorageType\n} from '../../src/storageManager.js';\nimport {\n  deepEqual,\n  deepSetValue,\n  delayExecution,\n  isArray,\n  isEmpty,\n  isFn,\n  isGptPubadsDefined,\n  isNumber,\n  isPlainObject,\n  logError,\n  logInfo,\n  logWarn,\n} from '../../src/utils.js';\nimport {getPPID as coreGetPPID} from '../../src/adserver.js';\nimport {defer, delay, PbPromise} from '../../src/utils/promise.js';\nimport {newMetrics, timedAuctionHook, useMetrics} from '../../src/utils/perfMetrics.js';\nimport {findRootDomain} from '../../src/fpd/rootDomain.js';\nimport {allConsent, GDPR_GVLIDS} from '../../src/consentHandler.js';\nimport {MODULE_TYPE_UID} from '../../src/activities/modules.js';\nimport {isActivityAllowed, registerActivityControl} from '../../src/activities/rules.js';\nimport {ACTIVITY_ACCESS_DEVICE, ACTIVITY_ENRICH_EIDS} from '../../src/activities/activities.js';\nimport {activityParams} from '../../src/activities/activityParams.js';\nimport {USERSYNC_DEFAULT_CONFIG, type UserSyncConfig} from '../../src/userSync.js';\nimport type {ORTBRequest} from \"../../src/types/ortb/request.d.ts\";\nimport type {AnyFunction, Wraps} from \"../../src/types/functions.d.ts\";\nimport type {ProviderParams, UserId, UserIdProvider, UserIdConfig, IdProviderSpec, ProviderResponse} from \"./spec.ts\";\nimport {\n  ACTIVITY_PARAM_COMPONENT_NAME,\n  ACTIVITY_PARAM_COMPONENT_TYPE,\n  ACTIVITY_PARAM_STORAGE_TYPE,\n  ACTIVITY_PARAM_STORAGE_WRITE\n} from '../../src/activities/params.js';\n\nconst MODULE_NAME = 'User ID';\nconst COOKIE = STORAGE_TYPE_COOKIES;\nconst LOCAL_STORAGE = STORAGE_TYPE_LOCALSTORAGE;\nexport const PBJS_USER_ID_OPTOUT_NAME = '_pbjs_id_optout';\nexport const coreStorage = getCoreStorageManager('userId');\nexport const dep = {\n  isAllowed: isActivityAllowed\n}\n\ndeclare module '../../src/userSync' {\n  interface UserSyncConfig {\n    /**\n     * EID source to use as PPID for GAM.\n     *\n     * Publishers using Google AdManager may want to sync one of the identifiers as their Google PPID for frequency capping or reporting.\n     * The PPID in GAM (which is unrelated to the PPID UserId Submodule) has strict rules; refer to Google AdManager documentation for them.\n     * Please note, Prebid uses a GPT command to sync identifiers for publisher convenience.\n     * It doesn’t currently work for instream video requests, as Prebid typically interacts with the player,\n     * which in turn may interact with IMA. IMA does has a similar method as GPT, but IMA does not gather this ID from GPT.\n     */\n    ppid?: string;\n    /**\n     * Map from userID name (the key in the object returned by `getUserIds`) to names of modules that should be preferred\n     * as sources for that ID, in order of decreasing priority.\n     */\n    idPriority?: {\n      [idName: keyof UserId]: UserIdProvider[]\n    }\n    userIds?: (UserIdConfig<keyof ProviderParams> | UserIdConfig<UserIdProvider>)[];\n    // TODO documentation for these is either missing or inscrutable\n    encryptedSignalSources?: {\n      sources: {\n        source: string[]\n        encrypt: boolean;\n        customFunc: AnyFunction\n      }[]\n      /**\n       * The amount of time (in milliseconds) after which registering of signals will happen. Default value 0 is considered if ‘registerDelay’ is not provided.\n       */\n      registerDelay?: number;\n    }\n    /**\n     * If true (the default), updating userSync.userIds will not remove previously configured IDs.\n     */\n    retainConfig?: boolean;\n    /**\n     * If true, updating userSync.userIds will automatically refresh IDs that have not yet been fetched.\n     */\n    autoRefresh?: boolean;\n\n    /**\n     * If true, user ID modules will only be allowed to save data in the location specified in the configuration.\n     */\n    enforceStorageType?: boolean;\n  }\n}\n\nlet submodules: SubmoduleContainer<UserIdProvider>[] = [];\nlet initializedSubmodules;\nlet configRegistry = [];\nlet idPriority = {};\nlet submoduleRegistry: IdProviderSpec<UserIdProvider>[] = [];\nlet timeoutID;\nexport let syncDelay;\nexport let auctionDelay;\n\nlet ppidSource;\n\nlet configListener;\n\nconst uidMetrics = (() => {\n  let metrics;\n  return () => {\n    if (metrics == null) {\n      metrics = newMetrics();\n    }\n    return metrics;\n  }\n})();\n\nfunction submoduleMetrics(moduleName) {\n  return uidMetrics().fork().renameWith(n => [`userId.mod.${n}`, `userId.mods.${moduleName}.${n}`])\n}\n\nexport function setSubmoduleRegistry(submodules) {\n  submoduleRegistry = submodules;\n  updateEIDConfig(submodules);\n}\n\nfunction cookieSetter(submodule, storageMgr?) {\n  storageMgr = storageMgr || submodule.storageMgr;\n  const domainOverride = (typeof submodule.submodule.domainOverride === 'function') ? submodule.submodule.domainOverride() : null;\n  const name = submodule.config.storage.name;\n  return function setCookie(suffix, value, expiration) {\n    storageMgr.setCookie(name + (suffix || ''), value, expiration, 'Lax', domainOverride);\n  }\n}\n\nfunction setValueInCookie(submodule, valueStr, expiresStr) {\n  const storage = submodule.config.storage;\n  const setCookie = cookieSetter(submodule);\n\n  setCookie(null, valueStr, expiresStr);\n  setCookie('_cst', getConsentHash(), expiresStr);\n  if (typeof storage.refreshInSeconds === 'number') {\n    setCookie('_last', new Date().toUTCString(), expiresStr);\n  }\n}\n\nfunction setValueInLocalStorage(submodule, valueStr, expiresStr) {\n  const storage = submodule.config.storage;\n  const mgr = submodule.storageMgr;\n\n  mgr.setDataInLocalStorage(`${storage.name}_exp`, expiresStr);\n  mgr.setDataInLocalStorage(`${storage.name}_cst`, getConsentHash());\n  mgr.setDataInLocalStorage(storage.name, encodeURIComponent(valueStr));\n  if (typeof storage.refreshInSeconds === 'number') {\n    mgr.setDataInLocalStorage(`${storage.name}_last`, new Date().toUTCString());\n  }\n}\n\nexport function setStoredValue(submodule, value) {\n  const storage = submodule.config.storage;\n\n  try {\n    const expiresStr = (new Date(Date.now() + (storage.expires * (60 * 60 * 24 * 1000)))).toUTCString();\n    const valueStr = isPlainObject(value) ? JSON.stringify(value) : value;\n\n    submodule.enabledStorageTypes.forEach(storageType => {\n      switch (storageType) {\n        case COOKIE:\n          setValueInCookie(submodule, valueStr, expiresStr);\n          break;\n        case LOCAL_STORAGE:\n          setValueInLocalStorage(submodule, valueStr, expiresStr);\n          break;\n      }\n    });\n  } catch (error) {\n    logError(error);\n  }\n}\n\nexport const COOKIE_SUFFIXES = ['', '_last', '_cst'];\n\nfunction deleteValueFromCookie(submodule) {\n  const setCookie = cookieSetter(submodule, coreStorage);\n  const expiry = (new Date(Date.now() - 1000 * 60 * 60 * 24)).toUTCString();\n\n  COOKIE_SUFFIXES.forEach(suffix => {\n    try {\n      setCookie(suffix, '', expiry);\n    } catch (e) {\n      logError(e);\n    }\n  })\n}\n\nexport const HTML5_SUFFIXES = ['', '_last', '_exp', '_cst'];\n\nfunction deleteValueFromLocalStorage(submodule) {\n  HTML5_SUFFIXES.forEach(suffix => {\n    try {\n      coreStorage.removeDataFromLocalStorage(submodule.config.storage.name + suffix);\n    } catch (e) {\n      logError(e);\n    }\n  });\n}\n\nexport function deleteStoredValue(submodule) {\n  populateEnabledStorageTypes(submodule);\n\n  submodule.enabledStorageTypes.forEach(storageType => {\n    switch (storageType) {\n      case COOKIE:\n        deleteValueFromCookie(submodule);\n        break;\n      case LOCAL_STORAGE:\n        deleteValueFromLocalStorage(submodule);\n        break;\n    }\n  });\n}\n\nfunction getValueFromCookie(submodule, storedKey) {\n  return submodule.storageMgr.getCookie(storedKey)\n}\n\nfunction getValueFromLocalStorage(submodule, storedKey) {\n  const mgr = submodule.storageMgr;\n  const storage = submodule.config.storage;\n  const storedValueExp = mgr.getDataFromLocalStorage(`${storage.name}_exp`);\n\n  // empty string means no expiration set\n  if (storedValueExp === '') {\n    return mgr.getDataFromLocalStorage(storedKey);\n  } else if (storedValueExp && ((new Date(storedValueExp)).getTime() - Date.now() > 0)) {\n    return decodeURIComponent(mgr.getDataFromLocalStorage(storedKey));\n  }\n}\n\nfunction getStoredValue(submodule, key = undefined) {\n  const storage = submodule.config.storage;\n  const storedKey = key ? `${storage.name}_${key}` : storage.name;\n  let storedValue;\n  try {\n    submodule.enabledStorageTypes.find(storageType => {\n      switch (storageType) {\n        case COOKIE:\n          storedValue = getValueFromCookie(submodule, storedKey);\n          break;\n        case LOCAL_STORAGE:\n          storedValue = getValueFromLocalStorage(submodule, storedKey);\n          break;\n      }\n\n      return !!storedValue;\n    });\n\n    // support storing a string or a stringified object\n    if (typeof storedValue === 'string' && storedValue.trim().charAt(0) === '{') {\n      storedValue = JSON.parse(storedValue);\n    }\n  } catch (e) {\n    logError(e);\n  }\n  return storedValue;\n}\n\nfunction processSubmoduleCallbacks(submodules, cb, priorityMaps) {\n  cb = uidMetrics().fork().startTiming('userId.callbacks.total').stopBefore(cb);\n  const done = delayExecution(() => {\n    clearTimeout(timeoutID);\n    cb();\n  }, submodules.length);\n  submodules.forEach(function (submodule) {\n    const moduleDone = submoduleMetrics(submodule.submodule.name).startTiming('callback').stopBefore(done);\n    function callbackCompleted(idObj) {\n      // if valid, id data should be saved to cookie/html storage\n      if (idObj) {\n        if (submodule.config.storage) {\n          setStoredValue(submodule, idObj);\n        }\n        // cache decoded value (this is copied to every adUnit bid)\n        submodule.idObj = submodule.submodule.decode(idObj, submodule.config);\n        priorityMaps.refresh();\n        updatePPID(priorityMaps);\n      } else {\n        logInfo(`${MODULE_NAME}: ${submodule.submodule.name} - request id responded with an empty value`);\n      }\n      moduleDone();\n    }\n    try {\n      submodule.callback(callbackCompleted, getStoredValue.bind(null, submodule));\n    } catch (e) {\n      logError(`Error in userID module '${submodule.submodule.name}':`, e);\n      moduleDone();\n    }\n    // clear callback, this prop is used to test if all submodule callbacks are complete below\n    submodule.callback = undefined;\n  });\n}\n\nfunction getIds(priorityMap): Partial<UserId> {\n  return Object.fromEntries(\n    Object.entries(priorityMap)\n      .map(([key, getActiveModule]: [string, any]) => [key, getActiveModule()?.idObj?.[key]])\n      .filter(([_, value]) => value != null)\n  )\n}\n\nfunction getPrimaryIds(submodule) {\n  if (submodule.primaryIds) return submodule.primaryIds;\n  const ids = Object.keys(submodule.eids ?? {});\n  if (ids.length > 1) {\n    throw new Error(`ID submodule ${submodule.name} can provide multiple IDs, but does not specify 'primaryIds'`)\n  }\n  return ids;\n}\n\n/**\n * Given a collection of items, where each item maps to any number of IDs (getKeys) and an ID module (getIdMod),\n * return a map from ID key to all items that map to that ID key, in order of priority (highest priority first).\n *\n */\nfunction orderByPriority(items, getKeys, getIdMod) {\n  const tally = {};\n  items.forEach(item => {\n    const module = getIdMod(item);\n    const primaryIds = getPrimaryIds(module);\n    getKeys(item).forEach(key => {\n      const keyItems = tally[key] = tally[key] ?? []\n      const keyPriority = idPriority[key]?.indexOf(module.name) ?? (primaryIds.includes(key) ? 0 : -1);\n      const pos = keyItems.findIndex(([priority]) => priority < keyPriority);\n      keyItems.splice(pos === -1 ? keyItems.length : pos, 0, [keyPriority, item])\n    })\n  })\n  return Object.fromEntries(Object.entries(tally).map(([key, items]: [string, any]) => [key, items.map(([_, item]) => item)]))\n}\n\nfunction mkPriorityMaps() {\n  const map = {\n    submodules: [],\n    global: {},\n    bidder: {},\n    combined: {},\n    /**\n     * @param {SubmoduleContainer[]} addtlModules\n     */\n    refresh(addtlModules = []) {\n      const refreshing = new Set(addtlModules.map(mod => mod.submodule));\n      map.submodules = map.submodules.filter((mod) => !refreshing.has(mod.submodule)).concat(addtlModules);\n      update();\n    }\n  }\n  function update() {\n    const modulesById = orderByPriority(\n      map.submodules,\n      (submod) => Object.keys(submod.idObj ?? {}),\n      (submod) => submod.submodule,\n    )\n    const global: any = {};\n    const bidder: any = {};\n\n    function activeModuleGetter(key, useGlobals, modules) {\n      return function () {\n        for (const {allowed, bidders, module} of modules) {\n          if (!dep.isAllowed(ACTIVITY_ENRICH_EIDS, activityParams(MODULE_TYPE_UID, module?.config?.name, {init: false}))) {\n            continue;\n          }\n          const value = module.idObj?.[key];\n          if (value != null) {\n            if (allowed) {\n              return module;\n            } else if (useGlobals) {\n              // value != null, allowed = false, useGlobals = true:\n              // this module has the preferred ID but it cannot be used (because it's restricted to only some bidders\n              // and we are calculating global IDs).\n              // since we don't (yet) have a way to express \"global except for these bidders\" in FPD,\n              // do not keep looking for alternative IDs in other (lower priority) modules; the ID will be provided only\n              // to the bidders this module is configured for.\n              const listModules = (modules) => modules.map(mod => mod.module.submodule.name).join(', ');\n              logWarn(`userID modules ${listModules(modules)} provide the same ID ('${key}'); ${module.submodule.name} is the preferred source, but it's configured only for some bidders, unlike ${listModules(modules.filter(mod => mod.bidders == null))}. Other bidders will not see the \"${key}\" ID.`)\n              return null;\n            } else if (bidders == null) {\n              // value != null, allowed = false, useGlobals = false, bidders == null:\n              // this module has the preferred ID but it should not be used because it's not bidder-restricted and\n              // we are calculating bidder-specific ids. Do not keep looking in other lower priority modules, as the ID\n              // will be set globally.\n              return null;\n            }\n          }\n        }\n        return null;\n      }\n    }\n\n    Object.entries(modulesById)\n      .forEach(([key, modules]) => {\n        let allNonGlobal = true;\n        const bidderFilters = new Set<any>();\n        modules = modules.map(module => {\n          let bidders = null;\n          if (Array.isArray(module.config.bidders) && module.config.bidders.length > 0) {\n            bidders = module.config.bidders;\n            bidders.forEach(bidder => bidderFilters.add(bidder));\n          } else {\n            allNonGlobal = false;\n          }\n          return {\n            module,\n            bidders\n          }\n        })\n        if (!allNonGlobal) {\n          global[key] = activeModuleGetter(key, true, modules.map(({bidders, module}) => ({allowed: bidders == null, bidders, module})));\n        }\n        bidderFilters.forEach(bidderCode => {\n          bidder[bidderCode] = bidder[bidderCode] ?? {};\n          bidder[bidderCode][key] = activeModuleGetter(key, false, modules.map(({bidders, module}) => ({allowed: bidders?.includes(bidderCode), bidders, module})));\n        })\n      });\n    const combined = Object.values(bidder).concat([global]).reduce((combo, map) => Object.assign(combo, map), {});\n    Object.assign(map, {global, bidder, combined});\n  }\n  return map;\n}\n\nexport function enrichEids(ortb2Fragments) {\n  const {global: globalFpd, bidder: bidderFpd} = ortb2Fragments;\n  const {global: globalMods, bidder: bidderMods} = initializedSubmodules;\n  const globalEids = getEids(globalMods);\n  if (globalEids.length > 0) {\n    deepSetValue(globalFpd, 'user.ext.eids', (globalFpd.user?.ext?.eids ?? []).concat(globalEids));\n  }\n  Object.entries(bidderMods).forEach(([bidder, moduleMap]) => {\n    const bidderEids = getEids(moduleMap);\n    if (bidderEids.length > 0) {\n      deepSetValue(\n        bidderFpd,\n        `${bidder}.user.ext.eids`,\n        (bidderFpd[bidder]?.user?.ext?.eids ?? []).concat(bidderEids)\n      );\n    }\n  })\n  return ortb2Fragments;\n}\n\ndeclare module '../../src/adapterManager' {\n  interface BaseBidRequest {\n    userIdAsEids: ORTBRequest['user']['eids'];\n  }\n}\n\nexport function addIdData({ortb2Fragments}) {\n  ortb2Fragments = ortb2Fragments ?? {global: {}, bidder: {}}\n  enrichEids(ortb2Fragments);\n}\n\nconst INIT_CANCELED = {};\n\nfunction idSystemInitializer({mkDelay = delay} = {}) {\n  const startInit = defer<void>();\n  const startCallbacks = defer<void>();\n  let cancel;\n  let initialized = false;\n  let initMetrics;\n\n  function cancelAndTry(promise) {\n    initMetrics = uidMetrics().fork();\n    if (cancel != null) {\n      cancel.reject(INIT_CANCELED);\n    }\n    cancel = defer();\n    return PbPromise.race([promise, cancel.promise])\n      .finally(initMetrics.startTiming('userId.total'))\n  }\n\n  // grab a reference to global vars so that the promise chains remain isolated;\n  // multiple calls to `init` (from tests) might otherwise cause them to interfere with each other\n  const initModules = initializedSubmodules;\n  const allModules = submodules;\n\n  function checkRefs(fn) {\n    // unfortunately tests have their own global state that needs to be guarded, so even if we keep ours tidy,\n    // we cannot let things like submodule callbacks run (they pollute things like the global `server` XHR mock)\n    return function(...args) {\n      if (initModules === initializedSubmodules && allModules === submodules) {\n        return fn(...args);\n      }\n    }\n  }\n\n  function timeConsent() {\n    return allConsent.promise.finally(initMetrics.startTiming('userId.init.consent'))\n  }\n\n  let done = cancelAndTry(\n    PbPromise.all([hooksReady, startInit.promise])\n      .then(timeConsent)\n      .then(checkRefs(() => {\n        initSubmodules(initModules, allModules);\n      }))\n      .then(() => startCallbacks.promise.finally(initMetrics.startTiming('userId.callbacks.pending')))\n      .then(checkRefs(() => {\n        const modWithCb = initModules.submodules.filter(item => isFn(item.callback));\n        if (modWithCb.length) {\n          return new PbPromise((resolve) => processSubmoduleCallbacks(modWithCb, resolve, initModules));\n        }\n      }))\n  );\n\n  /**\n   * with `ready` = true, starts initialization; with `refresh` = true, reinitialize submodules (optionally\n   * filtered by `submoduleNames`).\n   */\n  return function ({refresh = false, submoduleNames = null, ready = false} = {}) {\n    if (ready && !initialized) {\n      initialized = true;\n      startInit.resolve();\n      // submodule callbacks should run immediately if `auctionDelay` > 0, or `syncDelay` ms after the\n      // auction ends otherwise\n      if (auctionDelay > 0) {\n        startCallbacks.resolve();\n      } else {\n        events.on(EVENTS.AUCTION_END, function auctionEndHandler() {\n          events.off(EVENTS.AUCTION_END, auctionEndHandler);\n          mkDelay(syncDelay).then(startCallbacks.resolve);\n        });\n      }\n    }\n    if (refresh && initialized) {\n      done = cancelAndTry(\n        done\n          .catch(() => null)\n          .then(timeConsent) // fetch again in case a refresh was forced before this was resolved\n          .then(checkRefs(() => {\n            const cbModules = initSubmodules(\n              initModules,\n              allModules.filter((sm) => submoduleNames == null || submoduleNames.includes(sm.submodule.name)),\n              true\n            ).filter((sm) => {\n              return sm.callback != null;\n            });\n            if (cbModules.length) {\n              return new PbPromise((resolve) => processSubmoduleCallbacks(cbModules, resolve, initModules));\n            }\n          }))\n      );\n    }\n    return done;\n  };\n}\n\nlet initIdSystem;\n\nfunction getPPID(eids = getUserIdsAsEids() || []) {\n  // userSync.ppid should be one of the 'source' values in getUserIdsAsEids() eg pubcid.org or id5-sync.com\n  const matchingUserId = ppidSource && eids.find(userID => userID.source === ppidSource);\n  if (matchingUserId && typeof matchingUserId?.uids?.[0]?.id === 'string') {\n    const ppidValue = matchingUserId.uids[0].id.replace(/[\\W_]/g, '');\n    if (ppidValue.length >= 32 && ppidValue.length <= 150) {\n      return ppidValue;\n    } else {\n      logWarn(`User ID - Googletag Publisher Provided ID for ${ppidSource} is not between 32 and 150 characters - ${ppidValue}`);\n    }\n  }\n}\n\n/**\n * Hook is executed before adapters, but after consentManagement. Consent data is requied because\n * this module requires GDPR consent with Purpose #1 to save data locally.\n * The two main actions handled by the hook are:\n * 1. check gdpr consentData and handle submodule initialization.\n * 2. append user id data (loaded from cookied/html or from the getId method) to bids to be accessed in adapters.\n * @param {Object} reqBidsConfigObj required; This is the same param that's used in pbjs.requestBids.\n * @param {function} fn required; The next function in the chain, used by hook.ts\n */\nexport const startAuctionHook = timedAuctionHook('userId', function requestBidsHook(fn, reqBidsConfigObj: StartAuctionOptions, {mkDelay = delay, getIds = getUserIdsAsync} = {}) {\n  PbPromise.race([\n    getIds().catch(() => null),\n    mkDelay(auctionDelay)\n  ]).then(() => {\n    addIdData(reqBidsConfigObj);\n    uidMetrics().join(useMetrics(reqBidsConfigObj.metrics), {propagate: false, includeGroups: true});\n    // calling fn allows prebid to continue processing\n    fn.call(this, reqBidsConfigObj);\n  });\n});\n\n/**\n * Alias bid requests' `userIdAsEids` to `ortb2.user.ext.eids`\n * Do this lazily (instead of attaching a copy) so that it also shows EIDs added after the userId module runs (e.g. from RTD modules)\n */\nfunction aliasEidsHook(next, bidderRequests) {\n  bidderRequests.forEach(bidderRequest => {\n    bidderRequest.bids.forEach(bid =>\n      Object.defineProperty(bid, 'userIdAsEids', {\n        configurable: true,\n        get() {\n          return bidderRequest.ortb2.user?.ext?.eids;\n        }\n      })\n    )\n  })\n  next(bidderRequests);\n}\n\n/**\n * Is startAuctionHook added\n * @returns {boolean}\n */\nfunction addedStartAuctionHook() {\n  return !!startAuction.getHooks({hook: startAuctionHook}).length;\n}\n\n/**\n * This function will be exposed in global-name-space so that userIds stored by Prebid UserId module can be used by external codes as well.\n * Simple use case will be passing these UserIds to A9 wrapper solution\n */\nfunction getUserIds() {\n  return getIds(initializedSubmodules.combined)\n}\n\n/**\n * This function will be exposed in global-name-space so that userIds stored by Prebid UserId module can be used by external codes as well.\n * Simple use case will be passing these UserIds to A9 wrapper solution\n */\nfunction getUserIdsAsEids(): ORTBRequest['user']['eids'] {\n  return getEids(initializedSubmodules.combined)\n}\n\n/**\n * This function will be exposed in global-name-space so that userIds stored by Prebid UserId module can be used by external codes as well.\n * Simple use case will be passing these UserIds to A9 wrapper solution\n */\n\nfunction getUserIdsAsEidBySource(sourceName: string): ORTBRequest['user']['eids'][0] | undefined {\n  return getUserIdsAsEids().filter(eid => eid.source === sourceName)[0];\n}\n\n/**\n * This function will be exposed in global-name-space so that userIds for a source can be exposed\n * Sample use case is exposing this function to ESP\n */\nfunction getEncryptedEidsForSource(source, encrypt, customFunction) {\n  return retryOnCancel().then(() => {\n    const eidsSignals = {};\n\n    if (isFn(customFunction)) {\n      logInfo(`${MODULE_NAME} - Getting encrypted signal from custom function : ${customFunction.name} & source : ${source} `);\n      // Publishers are expected to define a common function which will be proxy for signal function.\n      const customSignals = customFunction(source);\n      eidsSignals[source] = customSignals ? encryptSignals(customSignals) : null; // by default encrypt using base64 to avoid JSON errors\n    } else {\n      // initialize signal with eids by default\n      const eid = getUserIdsAsEidBySource(source);\n      logInfo(`${MODULE_NAME} - Getting encrypted signal for eids :${JSON.stringify(eid)}`);\n      if (!isEmpty(eid)) {\n        eidsSignals[eid.source] = encrypt === true ? encryptSignals(eid) : eid.uids[0].id; // If encryption is enabled append version (1||) and encrypt entire object\n      }\n    }\n    logInfo(`${MODULE_NAME} - Fetching encrypted eids: ${eidsSignals[source]}`);\n    return eidsSignals[source];\n  })\n}\n\nfunction encryptSignals(signals, version = 1) {\n  let encryptedSig = '';\n  switch (version) {\n    case 1: // Base64 Encryption\n      encryptedSig = typeof signals === 'object' ? window.btoa(JSON.stringify(signals)) : window.btoa(signals); // Test encryption. To be replaced with better algo\n      break;\n    default:\n      break;\n  }\n  return `${version}||${encryptedSig}`;\n}\n\n/**\n * This function will be exposed in the global-name-space so that publisher can register the signals-ESP.\n */\nfunction registerSignalSources() {\n  if (!isGptPubadsDefined()) {\n    return;\n  }\n\n  const providers: googletag.secureSignals.SecureSignalProvider[] = window.googletag.secureSignalProviders = (window.googletag.secureSignalProviders || []) as googletag.secureSignals.SecureSignalProvider[];\n  const existingIds = new Set(providers.map(p => 'id' in p ? p.id : p.networkCode));\n  const encryptedSignalSources = config.getConfig('userSync.encryptedSignalSources');\n  if (encryptedSignalSources) {\n    const registerDelay = encryptedSignalSources.registerDelay || 0;\n    setTimeout(() => {\n      encryptedSignalSources['sources'] && encryptedSignalSources['sources'].forEach(({ source, encrypt, customFunc }) => {\n        source.forEach((src) => {\n          if (!existingIds.has(src)) {\n            providers.push({\n              id: src,\n              collectorFunction: () => getEncryptedEidsForSource(src, encrypt, customFunc)\n            });\n            existingIds.add(src);\n          }\n        });\n      })\n    }, registerDelay)\n  } else {\n    logWarn(`${MODULE_NAME} - ESP : encryptedSignalSources config not defined under userSync Object`);\n  }\n}\n\nfunction retryOnCancel(initParams?) {\n  return initIdSystem(initParams).then(\n    () => getUserIds(),\n    (e) => {\n      if (e === INIT_CANCELED) {\n        // there's a pending refresh - because GreedyPromise runs this synchronously, we are now in the middle\n        // of canceling the previous init, before the refresh logic has had a chance to run.\n        // Use a \"normal\" Promise to clear the stack and let it complete (or this will just recurse infinitely)\n        return Promise.resolve().then(getUserIdsAsync)\n      } else {\n        logError('Error initializing userId', e)\n        return PbPromise.reject(e)\n      }\n    }\n  );\n}\n\n/**\n * Force (re)initialization of ID submodules.\n *\n * This will force a refresh of the specified ID submodules regardless of `auctionDelay` / `syncDelay` settings, and\n * return a promise that resolves to the same value as `getUserIds()` when the refresh is complete.\n * If a refresh is already in progress, it will be canceled (rejecting promises returned by previous calls to `refreshUserIds`).\n *\n * submoduleNames submodules to refresh. If omitted, refresh all submodules.\n * callback called when the refresh is complete\n */\nfunction refreshUserIds({submoduleNames}: {\n  submoduleNames?: string[]\n} = {}, callback?: () => void): Promise<Partial<UserId>> {\n  return retryOnCancel({refresh: true, submoduleNames})\n    .then((userIds) => {\n      if (callback && isFn(callback)) {\n        callback();\n      }\n      return userIds;\n    });\n}\n\n/**\n * @returns a promise that resolves to the same value as `getUserIds()`, but only once all ID submodules have completed\n * initialization. This can also be used to synchronize calls to other ID accessors, e.g.\n *\n * ```\n * pbjs.getUserIdsAsync().then(() => {\n *   const eids = pbjs.getUserIdsAsEids(); // guaranteed to be completely initialized at this point\n * });\n * ```\n */\n\nfunction getUserIdsAsync(): Promise<Partial<UserId>> {\n  return retryOnCancel();\n}\n\nexport function getConsentHash() {\n  // transform decimal string into base64 to save some space on cookies\n  let hash = Number(allConsent.hash);\n  const bytes = [];\n  while (hash > 0) {\n    bytes.push(String.fromCharCode(hash & 255));\n    hash = hash >>> 8;\n  }\n  return btoa(bytes.join(''));\n}\n\nfunction consentChanged(submodule) {\n  const storedConsent = getStoredValue(submodule, 'cst');\n  return !storedConsent || storedConsent !== getConsentHash();\n}\n\nfunction populateSubmoduleId(submodule: SubmoduleContainer<UserIdProvider>, forceRefresh) {\n  const consentData = allConsent.getConsentData();\n\n  // There are two submodule configuration types to handle: storage or value\n  // 1. storage: retrieve user id data from cookie/html storage or with the submodule's getId method\n  // 2. value: pass directly to bids\n  if (submodule.config.storage) {\n    let storedId = getStoredValue(submodule);\n    let response;\n\n    let refreshNeeded = false;\n    if (typeof submodule.config.storage.refreshInSeconds === 'number') {\n      const storedDate = new Date(getStoredValue(submodule, 'last'));\n      refreshNeeded = storedDate && (Date.now() - storedDate.getTime() > submodule.config.storage.refreshInSeconds * 1000);\n    }\n\n    if (!storedId || refreshNeeded || forceRefresh || consentChanged(submodule)) {\n      const extendedConfig = Object.assign({ enabledStorageTypes: submodule.enabledStorageTypes }, submodule.config);\n\n      // No id previously saved, or a refresh is needed, or consent has changed. Request a new id from the submodule.\n      response = submodule.submodule.getId(extendedConfig, consentData, storedId);\n    } else if (typeof submodule.submodule.extendId === 'function') {\n      // If the id exists already, give submodule a chance to decide additional actions that need to be taken\n      response = submodule.submodule.extendId(submodule.config, consentData, storedId);\n    }\n\n    if (isPlainObject(response)) {\n      if (response.id) {\n        // A getId/extendId result assumed to be valid user id data, which should be saved to users local storage or cookies\n        setStoredValue(submodule, response.id);\n        storedId = response.id;\n      }\n\n      if (typeof response.callback === 'function') {\n        // Save async callback to be invoked after auction\n        submodule.callback = response.callback as any;\n      }\n    }\n\n    if (storedId) {\n      // cache decoded value (this is copied to every adUnit bid)\n      submodule.idObj = submodule.submodule.decode(storedId, submodule.config);\n    }\n  } else if (submodule.config.value) {\n    // cache decoded value (this is copied to every adUnit bid)\n    submodule.idObj = submodule.config.value;\n  } else {\n    const response = submodule.submodule.getId(submodule.config, consentData);\n    if (isPlainObject(response)) {\n      if (typeof response.callback === 'function') { submodule.callback = response.callback; }\n      if (response.id) { submodule.idObj = submodule.submodule.decode(response.id, submodule.config); }\n    }\n  }\n}\n\nfunction updatePPID(priorityMaps) {\n  const eids = getEids(priorityMaps.combined);\n  if (eids.length && ppidSource) {\n    const ppid = getPPID(eids);\n    if (ppid) {\n      if (isGptPubadsDefined()) {\n        window.googletag.pubads().setPublisherProvidedId(ppid);\n      } else {\n        (window as any).googletag = window.googletag || {};\n        (window.googletag as any).cmd = window.googletag.cmd || [];\n        window.googletag.cmd.push(function() {\n          window.googletag.pubads().setPublisherProvidedId(ppid);\n        });\n      }\n    }\n  }\n}\n\nfunction initSubmodules(priorityMaps, submodules, forceRefresh = false) {\n  return uidMetrics().fork().measureTime('userId.init.modules', function () {\n    if (!submodules.length) return []; // to simplify log messages from here on\n    submodules.forEach(submod => populateEnabledStorageTypes(submod));\n\n    /**\n     * filter out submodules that:\n     *\n     *  - cannot use the storage they've been set up with (storage not available / not allowed / disabled)\n     *  - are not allowed to perform the `enrichEids` activity\n     */\n    submodules = submodules.filter((submod) => {\n      return (!submod.config.storage || canUseStorage(submod)) &&\n        dep.isAllowed(ACTIVITY_ENRICH_EIDS, activityParams(MODULE_TYPE_UID, submod.config.name));\n    });\n\n    if (!submodules.length) {\n      logWarn(`${MODULE_NAME} - no ID module configured`);\n      return [];\n    }\n\n    const initialized = submodules.reduce((carry, submodule) => {\n      return submoduleMetrics(submodule.submodule.name).measureTime('init', () => {\n        try {\n          populateSubmoduleId(submodule, forceRefresh);\n          carry.push(submodule);\n        } catch (e) {\n          logError(`Error in userID module '${submodule.submodule.name}':`, e);\n        }\n        return carry;\n      })\n    }, []);\n    priorityMaps.refresh(initialized);\n    updatePPID(priorityMaps);\n    return initialized;\n  })\n}\n\nfunction getConfiguredStorageTypes(config) {\n  return config?.storage?.type?.trim().split(/\\s*&\\s*/) || [];\n}\n\nfunction hasValidStorageTypes(config) {\n  const storageTypes = getConfiguredStorageTypes(config);\n\n  return storageTypes.every(storageType => ALL_STORAGE_TYPES.has(storageType));\n}\n\n/**\n * list of submodule configurations with valid 'storage' or 'value' obj definitions\n * storage config: contains values for storing/retrieving User ID data in browser storage\n * value config: object properties that are copied to bids (without saving to storage)\n */\nexport function getValidSubmoduleConfigs(configRegistry) {\n  function err(msg, ...args) {\n    logWarn(`Invalid userSync.userId config: ${msg}`, ...args)\n  }\n  if (!Array.isArray(configRegistry)) {\n    if (configRegistry != null) {\n      err('must be an array', configRegistry);\n    }\n    return [];\n  }\n  return configRegistry.filter(config => {\n    if (!config?.name) {\n      return err('must specify \"name\"', config);\n    } else if (config.storage) {\n      if (!config.storage.name || !config.storage.type) {\n        return err('must specify \"storage.name\" and \"storage.type\"', config);\n      } else if (!hasValidStorageTypes(config)) {\n        return err('invalid \"storage.type\"', config)\n      }\n      ['expires', 'refreshInSeconds'].forEach(param => {\n        let value = config.storage[param];\n        if (value != null && typeof value !== 'number') {\n          value = Number(value)\n          if (isNaN(value)) {\n            err(`storage.${param} must be a number and will be ignored`, config);\n            delete config.storage[param];\n          } else {\n            config.storage[param] = value;\n          }\n        }\n      });\n    }\n    return true;\n  })\n}\n\nconst ALL_STORAGE_TYPES = new Set([LOCAL_STORAGE, COOKIE]);\n\nfunction canUseLocalStorage(submodule) {\n  if (!submodule.storageMgr.localStorageIsEnabled()) {\n    return false;\n  }\n\n  if (coreStorage.getDataFromLocalStorage(PBJS_USER_ID_OPTOUT_NAME)) {\n    logInfo(`${MODULE_NAME} - opt-out localStorage found, storage disabled`);\n    return false\n  }\n\n  return true;\n}\n\nfunction canUseCookies(submodule) {\n  if (!submodule.storageMgr.cookiesAreEnabled()) {\n    return false;\n  }\n\n  if (coreStorage.getCookie(PBJS_USER_ID_OPTOUT_NAME)) {\n    logInfo(`${MODULE_NAME} - opt-out cookie found, storage disabled`);\n    return false;\n  }\n\n  return true\n}\n\nconst STORAGE_PURPOSES = [1, 2, 3, 4, 7];\n\nfunction populateEnabledStorageTypes(submodule: SubmoduleContainer<UserIdProvider>) {\n  if (submodule.enabledStorageTypes) {\n    return;\n  }\n\n  const storageTypes = getConfiguredStorageTypes(submodule.config);\n\n  submodule.enabledStorageTypes = storageTypes.filter(type => {\n    switch (type) {\n      case LOCAL_STORAGE:\n        HTML5_SUFFIXES.forEach(suffix => {\n          discloseStorageUse('userId', {\n            type: 'web',\n            identifier: submodule.config.storage.name + suffix,\n            purposes: STORAGE_PURPOSES\n          })\n        })\n        return canUseLocalStorage(submodule);\n      case COOKIE:\n        COOKIE_SUFFIXES.forEach(suffix => {\n          discloseStorageUse('userId', {\n            type: 'cookie',\n            identifier: submodule.config.storage.name + suffix,\n            purposes: STORAGE_PURPOSES,\n            maxAgeSeconds: (submodule.config.storage.expires ?? 0) * 24 * 60 * 60,\n            cookieRefresh: true\n          })\n        })\n        return canUseCookies(submodule);\n    }\n\n    return false;\n  });\n}\n\nfunction canUseStorage(submodule) {\n  return !!submodule.enabledStorageTypes.length;\n}\n\nfunction updateEIDConfig(submodules) {\n  EID_CONFIG.clear();\n  Object.entries(\n    orderByPriority(\n      submodules,\n      (mod) => Object.keys(mod.eids || {}),\n      (mod) => mod\n    )\n  ).forEach(([key, submodules]) => EID_CONFIG.set(key, submodules[0].eids[key]))\n}\n\nexport function generateSubmoduleContainers(options, configs, prevSubmodules = submodules, registry = submoduleRegistry) {\n  const {autoRefresh, retainConfig} = options;\n  return registry\n    .reduce((acc, submodule) => {\n      const {name, aliasName} = submodule;\n      const matchesName = (query) => [name, aliasName].some(value => value?.toLowerCase() === query.toLowerCase());\n      const submoduleConfig = configs.find((configItem) => matchesName(configItem.name));\n\n      if (!submoduleConfig) {\n        if (!retainConfig) return acc;\n        const previousSubmodule = prevSubmodules.find(prevSubmodules => matchesName(prevSubmodules.config.name));\n        return previousSubmodule ? [...acc, previousSubmodule] : acc;\n      }\n\n      const newSubmoduleContainer: SubmoduleContainer<UserIdProvider> = {\n        submodule,\n        config: {\n          ...submoduleConfig,\n          name: submodule.name\n        },\n        callback: undefined,\n        idObj: undefined,\n        storageMgr: newStorageManager({\n          moduleType: MODULE_TYPE_UID,\n          moduleName: submoduleConfig.name,\n          // since this manager is only using keys provided directly by the publisher,\n          // turn off storageControl checks\n          advertiseKeys: false,\n        })\n      };\n\n      if (autoRefresh) {\n        const previousSubmodule = prevSubmodules.find(prevSubmodules => matchesName(prevSubmodules.config.name));\n        newSubmoduleContainer.refreshIds = !previousSubmodule || !deepEqual(newSubmoduleContainer.config, previousSubmodule.config);\n      }\n\n      return [...acc, newSubmoduleContainer];\n    }, []);\n}\n\ntype SubmoduleContainer<P extends UserIdProvider> = {\n  submodule: IdProviderSpec<P>;\n  enabledStorageTypes?: StorageType[];\n  config: UserIdConfig<P>;\n  callback?: ProviderResponse['callback'];\n  idObj;\n  storageMgr: StorageManager;\n  refreshIds?: boolean;\n}\n\n/**\n * update submodules by validating against existing configs and storage types\n */\nfunction updateSubmodules(options = {}) {\n  updateEIDConfig(submoduleRegistry);\n  const configs = getValidSubmoduleConfigs(configRegistry);\n  if (!configs.length) {\n    return;\n  }\n\n  const updatedContainers = generateSubmoduleContainers(options, configs);\n  submodules.splice(0, submodules.length);\n  submodules.push(...updatedContainers);\n\n  if (submodules.length) {\n    if (!addedStartAuctionHook()) {\n      startAuction.before(startAuctionHook, 100) // use higher priority than dataController / rtd\n      adapterManager.callDataDeletionRequest.before(requestDataDeletion);\n      coreGetPPID.after((next) => next(getPPID()));\n    }\n    logInfo(`${MODULE_NAME} - usersync config updated for ${submodules.length} submodules: `, submodules.map(a => a.submodule.name));\n  }\n}\n\n/**\n * This function will update the idPriority according to the provided configuration\n */\nfunction updateIdPriority(idPriorityConfig, submodules) {\n  if (idPriorityConfig) {\n    const result = {};\n    const aliasToName = new Map(submodules.map(s => s.aliasName ? [s.aliasName, s.name] : []));\n    Object.keys(idPriorityConfig).forEach(key => {\n      const priority = isArray(idPriorityConfig[key]) ? [...idPriorityConfig[key]].reverse() : []\n      result[key] = priority.map(s => aliasToName.has(s) ? aliasToName.get(s) : s);\n    });\n    idPriority = result;\n  } else {\n    idPriority = {};\n  }\n  initializedSubmodules.refresh();\n  updateEIDConfig(submodules)\n}\n\nexport function requestDataDeletion(next, ...args) {\n  logInfo('UserID: received data deletion request; deleting all stored IDs...')\n  submodules.forEach(submodule => {\n    if (typeof submodule.submodule.onDataDeletionRequest === 'function') {\n      try {\n        submodule.submodule.onDataDeletionRequest(submodule.config, submodule.idObj, ...args);\n      } catch (e) {\n        logError(`Error calling onDataDeletionRequest for ID submodule ${submodule.submodule.name}`, e);\n      }\n    }\n    deleteStoredValue(submodule);\n  })\n  next.apply(this, args);\n}\n\n/**\n * enable submodule in User ID\n */\nexport function attachIdSystem(submodule: IdProviderSpec<UserIdProvider>) {\n  submodule.findRootDomain = findRootDomain;\n  if (!(submoduleRegistry || []).find(i => i.name === submodule.name)) {\n    submoduleRegistry.push(submodule);\n    GDPR_GVLIDS.register(MODULE_TYPE_UID, submodule.name, submodule.gvlid)\n    updateSubmodules();\n    // TODO: a test case wants this to work even if called after init (the setConfig({userId}))\n    // so we trigger a refresh. But is that even possible outside of tests?\n    initIdSystem({refresh: true, submoduleNames: [submodule.name]});\n  }\n}\n\nfunction normalizePromise<T extends AnyFunction>(fn: T): Wraps<T> {\n  // for public methods that return promises, make sure we return a \"normal\" one - to avoid\n  // exposing confusing stack traces\n  return function(...args) {\n    return Promise.resolve(fn.apply(this, args));\n  } as any;\n}\n\ndeclare module '../../src/prebidGlobal' {\n  interface PrebidJS {\n    getUserIds: typeof getUserIds;\n    getUserIdsAsync: typeof getUserIdsAsync;\n    getUserIdsAsEids: typeof getUserIdsAsEids;\n    getEncryptedEidsForSource: typeof getEncryptedEidsForSource;\n    registerSignalSources: typeof registerSignalSources;\n    refreshUserIds: typeof refreshUserIds;\n    getUserIdsAsEidBySource: typeof getUserIdsAsEidBySource;\n  }\n}\n\nconst enforceStorageTypeRule = (userIdsConfig, enforceStorageType) => {\n  return (params) => {\n    if (params[ACTIVITY_PARAM_COMPONENT_TYPE] !== MODULE_TYPE_UID || !params[ACTIVITY_PARAM_STORAGE_WRITE]) return;\n\n    const matchesName = (query) => params[ACTIVITY_PARAM_COMPONENT_NAME]?.toLowerCase() === query?.toLowerCase();\n    const submoduleConfig = userIdsConfig.find((configItem) => matchesName(configItem.name));\n\n    if (!submoduleConfig || !submoduleConfig.storage) return;\n\n    if (params[ACTIVITY_PARAM_STORAGE_TYPE] !== submoduleConfig.storage.type) {\n      const reason = `${submoduleConfig.name} attempts to store data in ${params[ACTIVITY_PARAM_STORAGE_TYPE]} while configuration allows ${submoduleConfig.storage.type}.`;\n      if (enforceStorageType) {\n        return {allow: false, reason};\n      } else {\n        logWarn(reason);\n      }\n    }\n  }\n}\n\n/**\n * test browser support for storage config types (local storage or cookie), initializes submodules but consentManagement is required,\n * so a callback is added to fire after the consentManagement module.\n * @param {{getConfig:function}} config\n */\nexport function init(config, {mkDelay = delay} = {}) {\n  ppidSource = undefined;\n  submodules = [];\n  configRegistry = [];\n  initializedSubmodules = mkPriorityMaps();\n  initIdSystem = idSystemInitializer({mkDelay});\n  if (configListener != null) {\n    configListener();\n  }\n  submoduleRegistry = [];\n  let unregisterEnforceStorageTypeRule: () => void\n\n  // listen for config userSyncs to be set\n  configListener = config.getConfig('userSync', conf => {\n    // Note: support for 'usersync' was dropped as part of Prebid.js 4.0\n    const userSync: UserSyncConfig = conf.userSync;\n    if (userSync) {\n      ppidSource = userSync.ppid;\n      if (userSync.userIds) {\n        const {autoRefresh = false, retainConfig = true, enforceStorageType} = userSync;\n        configRegistry = userSync.userIds;\n        syncDelay = isNumber(userSync.syncDelay) ? userSync.syncDelay : USERSYNC_DEFAULT_CONFIG.syncDelay\n        auctionDelay = isNumber(userSync.auctionDelay) ? userSync.auctionDelay : USERSYNC_DEFAULT_CONFIG.auctionDelay;\n        updateSubmodules({retainConfig, autoRefresh});\n        unregisterEnforceStorageTypeRule?.();\n        unregisterEnforceStorageTypeRule = registerActivityControl(ACTIVITY_ACCESS_DEVICE, 'enforceStorageTypeRule', enforceStorageTypeRule(submodules.map(({config}) => config), enforceStorageType));\n        updateIdPriority(userSync.idPriority, submoduleRegistry);\n        initIdSystem({ready: true});\n        const submodulesToRefresh = submodules.filter(item => item.refreshIds);\n        if (submodulesToRefresh.length) {\n          refreshUserIds({submoduleNames: submodulesToRefresh.map(item => item.submodule.name)});\n        }\n      }\n    }\n  });\n  adapterManager.makeBidRequests.after(aliasEidsHook);\n\n  // exposing getUserIds function in global-name-space so that userIds stored in Prebid can be used by external codes.\n  addApiMethod('getUserIds', getUserIds);\n  addApiMethod('getUserIdsAsEids', getUserIdsAsEids);\n  addApiMethod('getEncryptedEidsForSource', normalizePromise(getEncryptedEidsForSource));\n  addApiMethod('registerSignalSources', registerSignalSources);\n  addApiMethod('refreshUserIds', normalizePromise(refreshUserIds));\n  addApiMethod('getUserIdsAsync', normalizePromise(getUserIdsAsync));\n  addApiMethod('getUserIdsAsEidBySource', getUserIdsAsEidBySource);\n}\n\nexport function resetUserIds() {\n  config.setConfig({userSync: {}})\n  init(config);\n}\n\n// init config update listener to start the application\ninit(config);\n\nmodule('userId', attachIdSystem, { postInstallAllowed: true });\n"],"names":["logError","deepClone","isFn","isStr","EID_CONFIG","Map","createEidObject","userIdData","subModuleKey","eidConf","eid","source","value","uid","id","atype","uidExt","ext","uids","inserter","matcher","mm","eidExt","createEidsArray","bidRequestUserId","eidConfigs","arguments","length","undefined","allEids","collect","key","JSON","stringify","toLowerCase","Object","keys","filter","k","includes","sort","map","hasOwnProperty","push","entries","forEach","_ref","name","values","Array","isArray","get","eids","_ref2","_ref3","e","getEids","priorityMap","idValues","_ref4","getActiveModule","submodule","idObj","orig","_len","args","_key","config","set","registerModule","__r0","events","addApiMethod","startAuction","adapterManager","EVENTS","module","ready","hooksReady","discloseStorageUse","getCoreStorageManager","newStorageManager","STORAGE_TYPE_COOKIES","STORAGE_TYPE_LOCALSTORAGE","deepEqual","deepSetValue","delayExecution","isEmpty","isGptPubadsDefined","isNumber","isPlainObject","logInfo","logWarn","getPPID","coreGetPPID","defer","delay","PbPromise","newMetrics","timedAuctionHook","useMetrics","findRootDomain","allConsent","GDPR_GVLIDS","MODULE_TYPE_UID","isActivityAllowed","registerActivityControl","ACTIVITY_ACCESS_DEVICE","ACTIVITY_ENRICH_EIDS","activityParams","USERSYNC_DEFAULT_CONFIG","ACTIVITY_PARAM_COMPONENT_NAME","ACTIVITY_PARAM_COMPONENT_TYPE","ACTIVITY_PARAM_STORAGE_TYPE","ACTIVITY_PARAM_STORAGE_WRITE","MODULE_NAME","COOKIE","LOCAL_STORAGE","PBJS_USER_ID_OPTOUT_NAME","coreStorage","dep","isAllowed","submodules","initializedSubmodules","configRegistry","idPriority","submoduleRegistry","timeoutID","syncDelay","auctionDelay","ppidSource","configListener","uidMetrics","metrics","submoduleMetrics","moduleName","fork","renameWith","n","setSubmoduleRegistry","updateEIDConfig","cookieSetter","storageMgr","domainOverride","storage","setCookie","suffix","expiration","setValueInCookie","valueStr","expiresStr","getConsentHash","refreshInSeconds","Date","toUTCString","setValueInLocalStorage","mgr","setDataInLocalStorage","encodeURIComponent","setStoredValue","now","expires","enabledStorageTypes","storageType","error","COOKIE_SUFFIXES","deleteValueFromCookie","expiry","HTML5_SUFFIXES","deleteValueFromLocalStorage","removeDataFromLocalStorage","deleteStoredValue","populateEnabledStorageTypes","getValueFromCookie","storedKey","getCookie","getValueFromLocalStorage","storedValueExp","getDataFromLocalStorage","getTime","decodeURIComponent","getStoredValue","storedValue","find","trim","charAt","parse","processSubmoduleCallbacks","cb","priorityMaps","startTiming","stopBefore","done","clearTimeout","moduleDone","callbackCompleted","decode","refresh","updatePPID","callback","bind","getIds","fromEntries","_","getPrimaryIds","primaryIds","ids","Error","orderByPriority","items","getKeys","getIdMod","tally","item","keyItems","keyPriority","indexOf","pos","findIndex","priority","splice","_ref5","mkPriorityMaps","global","bidder","combined","addtlModules","refreshing","Set","mod","has","concat","update","modulesById","submod","activeModuleGetter","useGlobals","modules","allowed","bidders","init","listModules","join","_ref6","allNonGlobal","bidderFilters","add","_ref7","bidderCode","_ref8","reduce","combo","assign","enrichEids","ortb2Fragments","globalFpd","bidderFpd","globalMods","bidderMods","globalEids","user","_ref9","moduleMap","bidderEids","addIdData","_ref0","INIT_CANCELED","idSystemInitializer","mkDelay","startInit","startCallbacks","cancel","initialized","initMetrics","cancelAndTry","promise","reject","race","finally","initModules","allModules","checkRefs","fn","timeConsent","all","then","initSubmodules","modWithCb","resolve","submoduleNames","on","AUCTION_END","auctionEndHandler","off","catch","cbModules","sm","initIdSystem","getUserIdsAsEids","matchingUserId","userID","ppidValue","replace","startAuctionHook","requestBidsHook","reqBidsConfigObj","getUserIdsAsync","propagate","includeGroups","call","aliasEidsHook","next","bidderRequests","bidderRequest","bids","bid","defineProperty","configurable","ortb2","addedStartAuctionHook","getHooks","hook","getUserIds","getUserIdsAsEidBySource","sourceName","getEncryptedEidsForSource","encrypt","customFunction","retryOnCancel","eidsSignals","customSignals","encryptSignals","signals","version","encryptedSig","window","btoa","registerSignalSources","providers","googletag","secureSignalProviders","existingIds","p","networkCode","encryptedSignalSources","getConfig","registerDelay","setTimeout","_ref1","customFunc","src","collectorFunction","initParams","Promise","refreshUserIds","userIds","hash","Number","bytes","String","fromCharCode","consentChanged","storedConsent","populateSubmoduleId","forceRefresh","consentData","getConsentData","storedId","response","refreshNeeded","storedDate","extendedConfig","getId","extendId","ppid","pubads","setPublisherProvidedId","cmd","measureTime","canUseStorage","carry","getConfiguredStorageTypes","type","split","hasValidStorageTypes","storageTypes","every","ALL_STORAGE_TYPES","getValidSubmoduleConfigs","err","msg","param","isNaN","canUseLocalStorage","localStorageIsEnabled","canUseCookies","cookiesAreEnabled","STORAGE_PURPOSES","identifier","purposes","maxAgeSeconds","cookieRefresh","clear","_ref10","generateSubmoduleContainers","options","configs","prevSubmodules","registry","autoRefresh","retainConfig","acc","aliasName","matchesName","query","some","submoduleConfig","configItem","previousSubmodule","newSubmoduleContainer","moduleType","advertiseKeys","refreshIds","updateSubmodules","updatedContainers","before","callDataDeletionRequest","requestDataDeletion","after","a","updateIdPriority","idPriorityConfig","result","aliasToName","s","reverse","_len2","_key2","onDataDeletionRequest","apply","attachIdSystem","i","register","gvlid","normalizePromise","_len3","_key3","enforceStorageTypeRule","userIdsConfig","enforceStorageType","params","reason","allow","unregisterEnforceStorageTypeRule","conf","userSync","_ref11","submodulesToRefresh","makeBidRequests","resetUserIds","setConfig","postInstallAllowed"],"sourceRoot":""}