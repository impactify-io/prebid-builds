{"version":3,"file":"gptPreAuction.js","mappings":"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","sources":["webpack:///../../modules/gptPreAuction.ts"],"sourcesContent":["import { getSignals as getSignalsFn, getSegments as getSegmentsFn, taxonomies } from '../libraries/gptUtils/gptUtils.js';\nimport { auctionManager } from '../src/auctionManager.js';\nimport { config } from '../src/config.js';\nimport { TARGETING_KEYS } from '../src/constants.js';\nimport { getHook } from '../src/hook.js';\nimport {\n  deepAccess,\n  deepSetValue,\n  isAdUnitCodeMatchingSlot,\n  isGptPubadsDefined,\n  logInfo,\n  logWarn,\n  pick,\n  uniques\n} from '../src/utils.js';\nimport type {SlotMatchingFn} from '../src/targeting.ts';\nimport type {AdUnitCode} from '../src/types/common.d.ts';\nimport type {AdUnit} from '../src/adUnits.ts';\n\nconst MODULE_NAME = 'GPT Pre-Auction';\nexport let _currentConfig: any = {};\nlet hooksAdded = false;\n\nexport function getSegments(fpd, sections, segtax) {\n  return getSegmentsFn(fpd, sections, segtax);\n}\n\nexport function getSignals(fpd) {\n  return getSignalsFn(fpd);\n}\n\nexport function getSignalsArrayByAuctionsIds(auctionIds, index = auctionManager.index) {\n  const signals = auctionIds\n    .map(auctionId => index.getAuction({ auctionId })?.getFPD()?.global)\n    .map(getSignals)\n    .filter(fpd => fpd);\n\n  return signals;\n}\n\nexport function getSignalsIntersection(signals) {\n  const result = {};\n  taxonomies.forEach((taxonomy) => {\n    const allValues = signals\n      .flatMap(x => x)\n      .filter(x => x.taxonomy === taxonomy)\n      .map(x => x.values);\n    result[taxonomy] = allValues.length ? (\n      allValues.reduce((commonElements, subArray) => {\n        return commonElements.filter(element => subArray.includes(element));\n      })\n    ) : []\n    result[taxonomy] = { values: result[taxonomy] };\n  })\n  return result;\n}\n\nexport function getAuctionsIdsFromTargeting(targeting, am = auctionManager) {\n  return Object.values(targeting)\n    .flatMap(x => Object.entries(x))\n    .filter((entry) => entry[0] === TARGETING_KEYS.AD_ID || entry[0].startsWith(TARGETING_KEYS.AD_ID + '_'))\n    .flatMap(entry => entry[1])\n    .map(adId => am.findBidByAdId(adId)?.auctionId)\n    .filter(id => id != null)\n    .filter(uniques);\n}\n\nexport const appendGptSlots = adUnits => {\n  const { customGptSlotMatching } = _currentConfig;\n\n  if (!isGptPubadsDefined()) {\n    return;\n  }\n\n  const adUnitMap = adUnits.reduce((acc, adUnit) => {\n    acc[adUnit.code] = acc[adUnit.code] || [];\n    acc[adUnit.code].push(adUnit);\n    return acc;\n  }, {});\n\n  const adUnitPaths = {};\n\n  window.googletag.pubads().getSlots().forEach((slot: googletag.Slot) => {\n    const matchingAdUnitCode = Object.keys(adUnitMap).find(customGptSlotMatching\n      ? customGptSlotMatching(slot)\n      : isAdUnitCodeMatchingSlot(slot));\n\n    if (matchingAdUnitCode) {\n      const path = adUnitPaths[matchingAdUnitCode] = slot.getAdUnitPath();\n      const adserver = {\n        name: 'gam',\n        adslot: sanitizeSlotPath(path)\n      };\n      adUnitMap[matchingAdUnitCode].forEach((adUnit) => {\n        deepSetValue(adUnit, 'ortb2Imp.ext.data.adserver', Object.assign({}, adUnit.ortb2Imp?.ext?.data?.adserver, adserver));\n      });\n    }\n  });\n  return adUnitPaths;\n};\n\nconst sanitizeSlotPath = (path) => {\n  const gptConfig = config.getConfig('gptPreAuction') || {};\n\n  if (gptConfig.mcmEnabled) {\n    return path.replace(/(^\\/\\d*),\\d*\\//, '$1/');\n  }\n\n  return path;\n}\n\nconst defaultPreAuction = (adUnit, adServerAdSlot, adUnitPath) => {\n  // confirm that GPT is set up\n  if (!isGptPubadsDefined()) {\n    return;\n  }\n\n  // find all GPT slots with this name\n  var gptSlots = window.googletag.pubads().getSlots().filter((slot: googletag.Slot) => slot.getAdUnitPath() === adUnitPath);\n\n  if (gptSlots.length === 0) {\n    return; // should never happen\n  }\n\n  if (gptSlots.length === 1) {\n    return adServerAdSlot;\n  }\n\n  // else the adunit code must be div id. append it.\n  return `${adServerAdSlot}#${adUnit.code}`;\n}\n\nexport const makeBidRequestsHook = (fn, adUnits, ...args) => {\n  const adUnitPaths = appendGptSlots(adUnits);\n  const { useDefaultPreAuction, customPreAuction } = _currentConfig;\n  adUnits.forEach(adUnit => {\n    // init the ortb2Imp if not done yet\n    adUnit.ortb2Imp = adUnit.ortb2Imp || {};\n    adUnit.ortb2Imp.ext = adUnit.ortb2Imp.ext || {};\n    adUnit.ortb2Imp.ext.data = adUnit.ortb2Imp.ext.data || {};\n    const context = adUnit.ortb2Imp.ext;\n\n    const adserverSlot = deepAccess(context, 'data.adserver.adslot');\n\n    // @todo: check if should have precedence over customPreAuction and defaultPreAuction\n    if (context.gpid) return;\n\n    let result;\n    if (customPreAuction) {\n      result = customPreAuction(adUnit, adserverSlot, adUnitPaths?.[adUnit.code]);\n    } else if (useDefaultPreAuction) {\n      result = defaultPreAuction(adUnit, adserverSlot, adUnitPaths?.[adUnit.code]);\n    } else {\n      logWarn('Neither customPreAuction, defaultPreAuction and gpid were specified')\n    }\n    if (result) {\n      context.gpid = result;\n    }\n  });\n  return fn.call(this, adUnits, ...args);\n};\n\nconst setPpsConfigFromTargetingSet = (next, targetingSet) => {\n  // set gpt config\n  const auctionsIds = getAuctionsIdsFromTargeting(targetingSet);\n  const signals = getSignalsIntersection(getSignalsArrayByAuctionsIds(auctionsIds));\n  window.googletag.setConfig && window.googletag.setConfig({pps: { taxonomies: signals }});\n  next(targetingSet);\n};\n\ntype GPTPreAuctionConfig = {\n  /**\n   * allows turning off of module. Default value is true\n   */\n  enabled?: boolean;\n  /**\n   * If true, use default behavior for determining GPID and PbAdSlot. Defaults to false.\n   */\n  useDefaultPreAuction?: boolean;\n  customGptSlotMatching?: SlotMatchingFn;\n  /**\n   * @param adUnitCode Ad unit code\n   * @param adServerAdSlot The value of that ad unit's `ortb2Imp.ext.data.adserver.adslot`\n   * @returns pbadslot for the ad unit\n   */\n  customPbAdSlot?: (adUnitCode: AdUnitCode, adServerAdSlot: string) => string;\n  /**\n   * @param adUnit An ad unit object\n   * @param adServerAdSlot The value of that ad unit's `ortb2Imp.ext.data.adserver.adslot`\n   * @param gptAdUnitPath GPT ad unit path for the slot matching the PBJS ad unit\n   * @returns GPID for the ad unit\n   */\n  customPreAuction?: (adUnit: AdUnit, adServerAdSlot: string, gptAdUnitPath: string) => string;\n  /**\n   * Removes extra network IDs when Multiple Customer Management is active. Default is false.\n   */\n  mcmEnabled?: boolean;\n}\n\ndeclare module '../src/config' {\n  interface Config {\n    gptPreAuction?: GPTPreAuctionConfig;\n  }\n}\n\nconst handleSetGptConfig = moduleConfig => {\n  _currentConfig = pick(moduleConfig, [\n    'enabled', enabled => enabled !== false,\n    'customGptSlotMatching', customGptSlotMatching =>\n      typeof customGptSlotMatching === 'function' && customGptSlotMatching,\n    'customPreAuction', customPreAuction => typeof customPreAuction === 'function' && customPreAuction,\n    'useDefaultPreAuction', useDefaultPreAuction => useDefaultPreAuction ?? true,\n  ]);\n\n  if (_currentConfig.enabled) {\n    if (!hooksAdded) {\n      getHook('makeBidRequests').before(makeBidRequestsHook);\n      getHook('targetingDone').after(setPpsConfigFromTargetingSet)\n      hooksAdded = true;\n    }\n  } else {\n    logInfo(`${MODULE_NAME}: Turning off module`);\n    _currentConfig = {};\n    getHook('makeBidRequests').getHooks({hook: makeBidRequestsHook}).remove();\n    getHook('targetingDone').getHooks({hook: setPpsConfigFromTargetingSet}).remove();\n    hooksAdded = false;\n  }\n};\n\nconfig.getConfig('gptPreAuction', config => handleSetGptConfig(config.gptPreAuction));\nhandleSetGptConfig({});\n"],"names":["registerModule","__r0","getSignals","getSignalsFn","getSegments","getSegmentsFn","taxonomies","auctionManager","config","TARGETING_KEYS","getHook","deepAccess","deepSetValue","isAdUnitCodeMatchingSlot","isGptPubadsDefined","logInfo","logWarn","pick","uniques","MODULE_NAME","_currentConfig","hooksAdded","fpd","sections","segtax","getSignalsArrayByAuctionsIds","auctionIds","index","arguments","length","undefined","signals","map","auctionId","_index$getAuction","getAuction","getFPD","global","filter","getSignalsIntersection","result","forEach","taxonomy","allValues","flatMap","x","values","reduce","commonElements","subArray","element","includes","getAuctionsIdsFromTargeting","targeting","am","Object","entries","entry","AD_ID","startsWith","adId","_am$findBidByAdId","findBidByAdId","id","appendGptSlots","adUnits","customGptSlotMatching","adUnitMap","acc","adUnit","code","push","adUnitPaths","window","googletag","pubads","getSlots","slot","matchingAdUnitCode","keys","find","path","getAdUnitPath","adserver","name","adslot","sanitizeSlotPath","_adUnit$ortb2Imp","assign","ortb2Imp","ext","data","gptConfig","getConfig","mcmEnabled","replace","defaultPreAuction","adServerAdSlot","adUnitPath","gptSlots","concat","makeBidRequestsHook","fn","useDefaultPreAuction","customPreAuction","context","adserverSlot","gpid","_len","args","Array","_key","call","_this","setPpsConfigFromTargetingSet","next","targetingSet","auctionsIds","setConfig","pps","handleSetGptConfig","moduleConfig","enabled","before","after","getHooks","hook","remove","gptPreAuction"],"sourceRoot":""}