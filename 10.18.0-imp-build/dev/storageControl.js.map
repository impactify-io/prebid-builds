{"version":3,"file":"storageControl.js","mappings":"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","sources":["webpack:///../../modules/storageControl.ts"],"sourcesContent":["import {config} from '../src/config.js';\nimport {metadata} from '../libraries/metadata/metadata.js';\nimport {\n  ACTIVITY_PARAM_COMPONENT,\n  ACTIVITY_PARAM_COMPONENT_NAME,\n  ACTIVITY_PARAM_COMPONENT_TYPE,\n  ACTIVITY_PARAM_STORAGE_KEY,\n  ACTIVITY_PARAM_STORAGE_TYPE\n} from '../src/activities/params.js';\nimport {\n  discloseStorageUse,\n  STORAGE_TYPE_COOKIES,\n  STORAGE_TYPE_LOCALSTORAGE,\n  type StorageDisclosure as Disclosure\n} from '../src/storageManager.js';\nimport {logWarn, uniques} from '../src/utils.js';\nimport {registerActivityControl} from '../src/activities/rules.js';\nimport {ACTIVITY_ACCESS_DEVICE} from '../src/activities/activities.js';\nimport {addApiMethod} from \"../src/prebid.ts\";\n// @ts-expect-error the ts compiler is confused by build-time renaming of summary.mjs to summary.js, reassure it\n// eslint-disable-next-line prebid/validate-imports\nimport {getStorageDisclosureSummary} from \"../libraries/storageDisclosure/summary.js\";\nimport {getGlobal} from \"../src/prebidGlobal.ts\";\n\nexport const ENFORCE_STRICT = 'strict';\nexport const ENFORCE_ALIAS = 'allowAliases';\nexport const ENFORCE_OFF = 'off';\n\nlet enforcement;\n\nfunction escapeRegExp(string) {\n  return string.replace(/[|\\\\{}()[\\]^$+*?.]/g, \"\\\\$&\");\n}\n\nfunction matches(params, disclosure) {\n  if (\n    !['cookie', 'web'].includes(disclosure.type) ||\n    (disclosure.type === 'cookie' && params[ACTIVITY_PARAM_STORAGE_TYPE] !== STORAGE_TYPE_COOKIES) ||\n    (disclosure.type === 'web' && params[ACTIVITY_PARAM_STORAGE_TYPE] !== STORAGE_TYPE_LOCALSTORAGE)\n  ) return false;\n  const pattern = new RegExp(`^${disclosure.identifier.split('*').map(escapeRegExp).join('.*?')}$`);\n  return pattern.test(params[ACTIVITY_PARAM_STORAGE_KEY]);\n}\n\nexport function getDisclosures(params, meta = metadata) {\n  const matchingDisclosures = [];\n  const disclosureURLs = {};\n  const data = meta.getMetadata(params[ACTIVITY_PARAM_COMPONENT_TYPE], params[ACTIVITY_PARAM_COMPONENT_NAME]);\n  if (!data) return null;\n  disclosureURLs[params[ACTIVITY_PARAM_COMPONENT_NAME]] = data.disclosureURL;\n  if (data.aliasOf) {\n    const parent = meta.getMetadata(params[ACTIVITY_PARAM_COMPONENT_TYPE], data.aliasOf);\n    if (parent) {\n      disclosureURLs[data.aliasOf] = parent.disclosureURL;\n    }\n  }\n  Object.entries(disclosureURLs).forEach(([componentName, disclosureURL]) => {\n    meta.getStorageDisclosure(disclosureURL)\n      ?.disclosures\n      ?.filter(disclosure => matches(params, disclosure))\n      ?.forEach(disclosure => {\n        matchingDisclosures.push({\n          [ACTIVITY_PARAM_COMPONENT_NAME]: componentName,\n          disclosureURL,\n          disclosure\n        })\n      })\n  })\n  return {\n    matches: matchingDisclosures,\n    disclosureURLs\n  };\n}\n\nexport function checkDisclosure(params, getMatchingDisclosures = getDisclosures) {\n  let disclosed = false;\n  let parent = false;\n  let reason = null;\n  const key = params[ACTIVITY_PARAM_STORAGE_KEY]\n  const component = params[ACTIVITY_PARAM_COMPONENT];\n  if (key) {\n    const disclosures = getMatchingDisclosures(params);\n    if (disclosures == null) {\n      reason = `Cannot determine if storage key \"${key}\" is disclosed by \"${component}\" because the necessary metadata is missing - was it included in the build?`\n    } else {\n      const {disclosureURLs, matches} = disclosures;\n      const moduleName = params[ACTIVITY_PARAM_COMPONENT_NAME]\n      for (const {componentName} of matches) {\n        if (componentName === moduleName) {\n          disclosed = true;\n        } else {\n          parent = true;\n          reason = `Storage key \"${key}\" is disclosed by module \"${componentName}\", but not by \"${moduleName}\" itself (the latter is an alias of the former)`\n        }\n        if (disclosed || parent) break;\n      }\n      if (!disclosed && !parent) {\n        reason = `Storage key \"${key}\" (for ${params[ACTIVITY_PARAM_STORAGE_TYPE]} storage) is not disclosed by \"${component}\"`\n        if (disclosureURLs[moduleName]) {\n          reason += ` @ ${disclosureURLs[moduleName]}`\n        } else {\n          reason += ` - no disclosure URL was provided, or it could not be retrieved`\n        }\n      }\n    }\n  } else {\n    disclosed = null;\n  }\n  return {\n    disclosed, parent, reason\n  }\n}\n\nexport function storageControlRule(getEnforcement = () => enforcement, check = checkDisclosure) {\n  return function (params) {\n    const {disclosed, parent, reason} = check(params);\n    if (disclosed === null) return;\n    if (!disclosed) {\n      const enforcement = getEnforcement();\n      if (enforcement === ENFORCE_STRICT || (enforcement === ENFORCE_ALIAS && !parent)) return {allow: false, reason};\n      if (reason) {\n        logWarn('storageControl:', reason);\n      }\n    }\n  }\n}\n\nregisterActivityControl(ACTIVITY_ACCESS_DEVICE, 'storageControl', storageControlRule());\n\nexport type StorageControlConfig = {\n  /**\n   * - 'off': logs a warning when an undisclosed storage key is used\n   * - 'strict': deny access to undisclosed storage keys\n   * - 'allowAliases': deny access to undisclosed storage keys, unless the use is from an alias of a module that does\n   *    disclose them\n   */\n  enforcement?: typeof ENFORCE_OFF | typeof ENFORCE_ALIAS | typeof ENFORCE_STRICT;\n}\n\ndeclare module '../src/config' {\n  interface Config {\n    storageControl: StorageControlConfig\n  }\n}\n\nconfig.getConfig('storageControl', (cfg) => {\n  enforcement = cfg?.storageControl?.enforcement ?? ENFORCE_OFF;\n})\n\nexport function dynamicDisclosureCollector() {\n  const disclosures = {};\n  function mergeDisclosures(left, right) {\n    const merged = {\n      ...left,\n      purposes: (left.purposes ?? []).concat(right.purposes ?? []).filter(uniques),\n    };\n    if (left.type === 'cookie') {\n      if (left.maxAgeSeconds != null || right.maxAgeSeconds != null) {\n        merged.maxAgeSeconds = (left.maxAgeSeconds ?? 0) > (right.maxAgeSeconds ?? 0) ? left.maxAgeSeconds : right.maxAgeSeconds;\n      }\n      if (left.cookieRefresh != null || right.cookieRefresh != null) {\n        merged.cookieRefresh = left.cookieRefresh || right.cookieRefresh;\n      }\n    }\n    return merged;\n  }\n  return {\n    hook(next, moduleName, disclosure) {\n      const key = `${disclosure.type}::${disclosure.identifier}`;\n      if (!disclosures.hasOwnProperty(key)) {\n        disclosures[key] = {\n          disclosedBy: [],\n          ...disclosure\n        };\n      }\n      Object.assign(disclosures[key], mergeDisclosures(disclosures[key], disclosure));\n      if (!disclosures[key].disclosedBy.includes(moduleName)) {\n        disclosures[key].disclosedBy.push(moduleName);\n      }\n      next(moduleName, disclosure);\n    },\n    getDisclosures() {\n      return Object.values(disclosures);\n    }\n  }\n}\n\nconst {hook: discloseStorageHook, getDisclosures: dynamicDisclosures} = dynamicDisclosureCollector();\ndiscloseStorageUse.before(discloseStorageHook);\n\nexport type StorageDisclosure = Disclosure & {\n  /**\n   * URL containing this disclosure, if any.\n   */\n  disclosedIn: string | null;\n  /**\n   * Names of the modules associated with this disclosure.\n   */\n  disclosedBy: string[];\n}\n\nfunction disclosureSummarizer(getDynamicDisclosures = dynamicDisclosures, getSummary = () => getStorageDisclosureSummary(getGlobal().installedModules, metadata.getModuleMetadata)) {\n  return function() {\n    return [].concat(\n      getDynamicDisclosures().map(disclosure => ({\n        disclosedIn: null,\n        ...(disclosure as any)\n      })),\n      getSummary()\n    );\n  }\n}\n\nconst getStorageUseDisclosures: () => StorageDisclosure[] = disclosureSummarizer();\n\ndeclare module '../src/prebidGlobal' {\n  interface PrebidJS {\n    getStorageUseDisclosures: typeof getStorageUseDisclosures;\n  }\n}\n\naddApiMethod('getStorageUseDisclosures', getStorageUseDisclosures);\n"],"names":["registerModule","__r0","config","metadata","ACTIVITY_PARAM_COMPONENT","ACTIVITY_PARAM_COMPONENT_NAME","ACTIVITY_PARAM_COMPONENT_TYPE","ACTIVITY_PARAM_STORAGE_KEY","ACTIVITY_PARAM_STORAGE_TYPE","discloseStorageUse","STORAGE_TYPE_COOKIES","STORAGE_TYPE_LOCALSTORAGE","logWarn","uniques","registerActivityControl","ACTIVITY_ACCESS_DEVICE","addApiMethod","getStorageDisclosureSummary","getGlobal","ENFORCE_STRICT","ENFORCE_ALIAS","ENFORCE_OFF","enforcement","escapeRegExp","string","replace","matches","params","disclosure","includes","type","pattern","RegExp","concat","identifier","split","map","join","test","getDisclosures","meta","arguments","length","undefined","matchingDisclosures","disclosureURLs","data","getMetadata","disclosureURL","aliasOf","parent","Object","entries","forEach","_ref","_meta$getStorageDiscl","componentName","getStorageDisclosure","disclosures","filter","push","checkDisclosure","getMatchingDisclosures","disclosed","reason","key","component","moduleName","storageControlRule","getEnforcement","check","allow","getConfig","cfg","_cfg$storageControl$e","_cfg$storageControl","storageControl","dynamicDisclosureCollector","mergeDisclosures","left","right","_left$purposes","_right$purposes","merged","_objectSpread","purposes","maxAgeSeconds","_left$maxAgeSeconds","_right$maxAgeSeconds","cookieRefresh","hook","next","hasOwnProperty","disclosedBy","assign","values","discloseStorageHook","dynamicDisclosures","before","disclosureSummarizer","getDynamicDisclosures","getSummary","installedModules","getModuleMetadata","disclosedIn","getStorageUseDisclosures"],"sourceRoot":""}